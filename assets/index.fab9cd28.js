var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,l=(e,l)=>{for(var n in l||(l={}))a.call(l,n)&&s(e,n,l[n]);if(t)for(var n of t(l))i.call(l,n)&&s(e,n,l[n]);return e};import{o as n,c as o,a as r,v as d,b as c,E as u,d as g,C as m,e as p,f as _,g as h,h as f,i as v,j as b,u as w,k as I,r as S,l as y,m as E,n as T,p as O,w as x,t as k,q as L,s as A,x as C,y as D,z as $,A as P,B as U,D as R,F as G,G as M,H as N,I as j,J as z,K as H,L as F,M as V,N as B,O as X,P as q,Q as J,R as K,S as W,T as Z,U as Y,V as Q,W as ee,X as te,Y as ae,Z as ie,_ as se,$ as le,a0 as ne,a1 as oe,a2 as re,a3 as de,a4 as ce,a5 as ue,a6 as ge,a7 as me,a8 as pe,a9 as _e,aa as he,ab as fe,ac as ve,ad as be,ae as we,af as Ie,ag as Se,ah as ye,ai as Ee,aj as Te,ak as Oe,al as xe,am as ke,an as Le,ao as Ae}from"./vendor.58908e37.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Ce={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},De=[r("path",{fill:"currentColor",d:"M544 864V672h128L512 480L352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.81 239.81 0 0 1 512 192a239.87 239.87 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6z"},null,-1)];var $e={name:"ep-upload-filled",render:function(e,t){return n(),o("svg",Ce,[...De])}};const Pe=(e,t)=>({type:"dir",dir:e,dirPath:t,childrenDirs:[],imageList:[]});function Ue(e,t,a){var i;return e?t.length===a?e:Ue(null==(i=e.childrenDirs)?void 0:i.find((e=>e.dir===t[a])),t,++a):null}const Re=(e,t)=>{if("/"===e)return t;return Ue(t,e.split("/"),0)},Ge=(e,t)=>{var a;return"dir"===t?null==(a=e.childrenDirs)?void 0:a.filter((e=>"dir"===e.type)):"image"===t?e.imageList.filter((e=>"image"===e.type)):[]};var Me={repo:"仓库",branch:"分支",dir:"目录",tip:"提示",delete:"删除",reset:"重置",confirm:"确定",cancel:"取消",author:"作者",document:"文档",shortcut_key:"快捷键",username:"用户名",email:"邮箱",login:"登录",logout:"退出登录",language:"语言",uploaded:"已上传",upload:"上传",rename:"重命名",copy_link:"复制图片链接",paste_image:"粘贴图片",copy_success_1:"图片链接已自动复制到系统剪贴板",copy_success_2:"图片链接复制成功",copy_fail_1:"复制失败",header:{not_login:"未登录",theme:"主题"},nav:{config:"图床配置",upload:"上传图片",management:"图床管理",settings:"图床设置",toolbox:"工具箱",feedback:"帮助反馈",actions:"快捷操作"},actions:{watermark:"图片水印",compress:"压缩图片",transform:"转换 "},config_page:{input_token:"请输入 GitHub Token ...",one_click_config:"一键配置",loading_1:"正在加载用户信息 ...",loading_4:"正在加载仓库目录数据 ...",loading_5:"正在加载目录信息 ...",loading_6:"正在自动配置 ...",placeholder_4:"请输入新建的目录 ...",placeholder_5:"请选择一个目录 ...",message_1:"GitHub Token 不能为空",message_2:"用户信息获取失败，请确认 Token 是否正确",message_3:"自动创建 GitHub 仓库失败，请稍后再试",message_4:"图床配置成功",message_5:"一键自动配置失败，请重试",message_6:"目录不能为空",message_7:"请输入一个新目录",message_8:"请选择仓库里的一个目录",message_9:"仓库信息获取失败，请稍后重试",dir_mode:"目录模式",create_new_dir:"新建目录",input_new_dir:"手动输入一个新目录",root_dir:"根目录",date_dir:"日期目录",date_dir_tip:"自动创建 yyyyMMdd 格式的日期目录",repo_dir:"仓库目录",select_dir:"选择目录",reload:"重新加载"},settings_page:{img_name:{title:"图片名称设置",hash_switch_name:"哈希化",hash_switch_desc:"上传时给图片名称增加哈希值，确保图片名称唯一，强烈建议开启",prefix_switch_name:"添加前缀",prefix_switch_desc:"上传时给图片名称增加前缀，例如：abc-image.jpg，abc- 为前缀",prefix_input_placeholder:"请输入前缀 ..."},img_watermark:{title:"图片水印设置",switch_name:"是否添加水印",switch_desc:"开启后可以自定义水印文字、字体大小、位置、颜色和透明度",text:"水印文字",text_input_placeholder:"请输入水印文字，限制 20 字",size:"水印大小",color:"水印颜色",opacity:"水印透明度",position:"水印位置",position_1:"左上角",position_2:"左下角",position_3:"右上角",position_4:"右下角"},img_compress:{title:"图片压缩设置",switch_name:"是否压缩图片",switch_desc:"开启后上传前会自动压缩图片，有效缩短图片上传和加载时间，强烈建议开启",radio_group_title:"选择图片压缩算法",radio_1:"webP",radio_1_desc:"压缩后图片格式为 webp，压缩率较高，大多数浏览器支持",radio_2:"mozJPEG",radio_2_desc:"压缩后图片格式为 jpg，兼容性最好，所有浏览器支持",radio_3:"avif",radio_3_desc:"压缩后图片格式为 avif，压缩率极高，部分现代浏览器支持"},link_rule:{title:"图片链接规则配置",select_title:"选择图片链接规则",card_title:"配置自定义图片链接规则",card_table_col_title_1:"类型",card_table_col_title_2:"图片链接规则",card_table_col_title_3:"操作",input_name_1:"图片链接类型",input_name_1_rule:"图片链接类型名称不能为空",input_name_2:"图片链接规则",input_name_2_rule:"图片链接规则不能为空",btn_name_1:"添加图片链接规则",error_msg_1:"添加失败，该图片链接规则已存在",error_msg_2:"{action}失败，图片链接规则必须包含 {path}",error_msg_3:"图片链接规则缺少 {rules}，是否确认{action}？",add:"添加",edit:"编辑"},link_format:{title:"图片链接格式设置",switch_name:"自动转换图片链接格式",switch_desc:"上传成功后复制的图片链接自动转换成 {type} 格式",select_title:"选择图片链接格式",delete_tips:"此操作将永久删除图片链接规则"},image_hosting_deploy:{title:"图床部署",one_click_deploy:"一键部署",deploy_to:"部署到 {server}",success:"部署成功",fail:"部署失败",fail2:"部署失败，请稍后再试",deploying:"正在部署到 GitHub Pages，该过程持续 1 分钟左右，请耐心等待 ...",not_deployed:"未部署"},theme:{title:"主题设置",system:"跟随系统",dark:"暗夜",light:"白昼"},cloud_settings:{tip_1:"检测到你的设置数据未保存到云端仓库，是否保存？",tip_2:"检测到你的云端仓库存在设置文件，是否使用？",tip_3:"检测到你的设置数据有变化，是否同步到云端仓库？",tip_4:"本地设置数据和云端仓库设置数据一致",success_msg_1:"保存成功",success_msg_2:"更新成功"}},upload_page:{upload_area_text:"拖拽 / 粘贴 / 点击此处选择图片",message1:"请先完成图床配置",message2:"请选择一个仓库",message3:"目录不能为空",message4:"请选择要上传的图片",message5:"图片上传成功",message6:"图片批量上传成功",message7:"上传失败，请稍后重试",message8:"图片上传成功",fold:"折叠",expand:"展开",add_hash:"哈希化",add_prefix:"添加前缀",uploading:"正在上传 ...",tip_9:"{name} 不是图片格式",tip_10:"{name} 超过 {size} MB，跳过选择",tip_11:"{name} 上传失败"},management_page:{reload:"重新加载",loadingTxt1:"加载中 ...",loadingTxt2:"正在重命名 ...",loadingTxt3:"删除中 ...",property:"属性",delTips:"此操作将会永久删除图片",delTips2:"已选中 {total} 张图片，是否批量删除？",message1:"图片名称不能为空",message2:"图片名无改变",message3:"重命名失败，请重试",message4:"更新成功",message5:"删除成功",message6:"批量删除成功",message7:"删除失败，请稍后重试",imageName:"图片名称",imageSize:"图片大小",selectAll:"全选",deselectAll:"取消全选",unselect:"取消选择",batchCopy:"批量复制图片链接",batchDelete:"批量删除图片",selectTotal:"已选择 {total} 张图片",contextmenu_1:"从当前位置上传新图片",contextmenu_2:"上传图片到 {dir}",contextmenu_3:"根目录",text_1:"请输入新的图片名称",text_2:"立即上传"},toolbox:{tool_1:"图片压缩",tool_1_desc:"不限制图片大小和数量，不上传至服务器的离线极致压缩",tool_2:"图片转 Base64",tool_2_desc:"不限制图片大小和数量，在线转换成 Base64 编码",tool_3:"图片水印 ",tool_3_desc:"自定义水印文字、字体大小、位置、颜色和透明度",copy_base64:"点击复制 Base64 编码",copy_base64_success:"Base64 编码复制成功",click_download:"点击下载",compress:"压缩",batch_download:"批量下载",add_watermark:"添加水印"},feedback:{text_1:"PicX 是一款基于 GitHub API 开发的图床工具，提供图片上传托管、生成图片链接和常用图片工具箱服务。",text_2:"建议将本站添加到浏览器收藏夹，方便下次使用。",text_3:"如果 PicX 对你有帮助，欢迎赞赏作者，支持开源。",text_4:"郑重声明：请勿使用 PicX 上传违反你当地法律的图片，所造成的一切后果与作者无关。"},region:{CN:"中国大陆",HK:"中国香港",MO:"中国澳门",TW:"中国台湾",SG:"新加坡",JP:"日本",US:"美国",NL:"荷兰"},languages:{"zh-CN":"中文简体","zh-TW":"中文繁体",en:"英文"},toggle_language_msg:"检测到你的 IP 所属地为{region}，是否切换{language}？",authorization:{msg_1:"GitHub OAuth 授权登录已过期，请重新授权",msg_2:"未在 GitHub 安装 PicX APP，暂无操作权限",msg_3:"PicX GitHub APP 安装成功，是否进行授权登录？",msg_4:"授权失败，稍后重试",btn_1:"立即安装",loading_1:"正在授权登录...",text_1:"GitHub OAuth 授权登录",text_2:"填写 GitHub Token 登录",text_3:"正在使用 GitHub OAuth 授权登录",text_4:"GitHub Token 已过期，请重新授权登录",text_5:"正在使用填写 GitHub Token 登录",text_6:"返回登录页",text_7:"切换",text_8:"使用 GitHub OAuth 授权登录必须安装 PicX GitHub APP",text_9:"填写 GitHub Token 登录必须生成具有操作权限的 Token",text_10:"查看教程",text_11:"安装 PicX GitHub APP",text_12:"创建 GitHub Token",text_13:"立即授权"},copy_repo_img:{text_1:"复制仓库图片",text_2:"请输入仓库名称",text_3:"请输入分支名称",text_4:"仓库或分支不正确，请重新输入",text_6:"{repo} 仓库图片复制成功",text_7:"{repo} 仓库图片复制失败，稍后重试",text_8:"复制其他仓库图片",loading_1:"复制中"}};const Ne=d.createI18n({locale:"zh-CN",messages:{"zh-CN":Me}}),je=e=>{const t=Object.prototype.toString.call(e).split(" ")[1];return t.substring(0,t.length-1).toLowerCase()},ze=()=>Number(Math.random().toString().substring(2,4)+Date.now()).toString(36),He=(e,t)=>{navigator.clipboard.writeText(e).then((()=>{t&&t()}))},Fe=e=>{for(const t in e)switch(je(e[t])){case"object":Fe(e[t]);break;case"string":e[t]="";break;case"array":e[t]=[];break;case"number":e[t]=0;break;case"boolean":e[t]=!1}},Ve=(e,t)=>{for(const a in t)"object"!==je(t[a])?e[a]=t[a]:(Object.hasOwn(e,a)||(e[a]={}),Ve(e[a],t[a]))},Be=(e="yyyy-MM-dd hh:mm:ss",t=Date.now())=>{function a(e){return`00${e}`.substr(e.length)}const i=new Date(t);/(y+)/.test(e)&&(e=e.replace(RegExp.$1,`${i.getFullYear()}`.substr(4-RegExp.$1.length)));const s={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds()};for(const l in s)if(new RegExp(`(${l})`).test(e)){const t=`${s[l]}`;e=e.replace(RegExp.$1,1===RegExp.$1.length?t:a(t))}return e},Xe=e=>{e&&(window.document.title=`${Ne.global.t(e)} | PicX`)},qe=(e,t)=>{function a(e){const t={};for(const[i,s]of Object.entries(e))if("object"==typeof s&&null!==s){const e=a(s);for(const[a,s]of Object.entries(e))t[`${i}.${a}`]=s}else t[i]=s;return t}return Object.entries(a(e)).toString()===Object.entries(a(t)).toString()};var Je,Ke,We,Ze,Ye,Qe,et,tt,at,it,st,lt,nt,ot,rt,dt,ct,ut;async function gt(e,t){const{text:a,fontSize:i,position:s,textColor:l,opacity:n}=t,[o,r,d]=(c=l,c?(c=c.replace("#",""),`${parseInt(c.substring(0,2),16)}, ${parseInt(c.substring(2,4),16)}, ${parseInt(c.substring(4,6),16)}`):"255,255,255").split(",");var c;const u=await function(e){return new Promise(((t,a)=>{const i=new FileReader;i.onload=()=>{const e=new Image;e.setAttribute("crossOrigin","Anonymous"),e.onload=()=>t(e),e.onerror=a,e.src=i.result},i.onerror=a,i.readAsDataURL(e)}))}(e),g=document.createElement("canvas"),m=g.getContext("2d");g.width=u.width,g.height=u.height,m.drawImage(u,0,0),m.font=`bold ${i}px Arial`,m.strokeStyle=`rgba(0, 0, 0, ${n})`,m.lineWidth=3,m.fillStyle=`rgba(${o}, ${r}, ${d}, ${n})`;let p=0,_=0;switch(s){case nt.leftTop:p=10,_=i+5;break;case nt.rightTop:p=g.width-m.measureText(a).width-10,_=i+5;break;case nt.leftBottom:p=10,_=g.height-15;break;case nt.rightBottom:p=g.width-m.measureText(a).width-10,_=g.height-15}return m.strokeText(a,p,_),m.fillText(a,p,_),new Promise((t=>{g.toBlob((a=>{if(a){const i=new File([a],e.name,{type:e.type});t(i)}else t(null)}),e.type)}))}(Ke=Je||(Je={})).uploaded="uploaded",Ke.allUploaded="allUploaded",Ke.uploadFail="uploadFail",(Ze=We||(We={})).deleted="deleted",Ze.allDeleted="allDeleted",Ze.deleteFail="deleteFail",(Qe=Ye||(Ye={})).mozJPEG="mozJPEG",Qe.avif="avif",Qe.webP="webP",(tt=et||(et={})).GitHub="GitHub",tt.GitHubPages="GitHub Pages",tt.jsDelivr="jsDelivr",tt.ChinaJsDelivr="ChinaJsDelivr",tt.Statically="Statically",(it=at||(at={})).rootDir="rootDir",it.dateDir="dateDir",it.repoDir="repoDir",it.newDir="newDir",(lt=st||(st={})).large="large",lt.default="default",lt.small="small",(ot=nt||(nt={})).leftTop="leftTop",ot.leftBottom="leftBottom",ot.rightTop="rightTop",ot.rightBottom="rightBottom",(dt=rt||(rt={})).system="system",dt.light="light",dt.dark="dark",(ut=ct||(ct={})).zhCN="zh-CN",ut.zhTW="zh-TW",ut.en="en";const mt=e=>{const t=window.localStorage.getItem(e);return t?JSON.parse(t):null},pt=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},_t=(e,t)=>{sessionStorage.setItem(e,JSON.stringify(t))},ht="https://api.github.com",ft=c.create({baseURL:ht,timeout:3e5});function vt(e){const{success422:t,noShowErrMsg:a,noCache:i}=e;return i&&(e.cache={maxAge:0},e.params=e.params?e.params:{},e.params.timestamp=Date.now(),delete e.noCache),new Promise((i=>{ft.request(e).then((e=>{const{status:t,data:a}=e;i(!e||200!==t&&201!==t&&204!==t?null:a||"SUCCESS")})).catch((e=>{var s;if(t&&422===(null==e?void 0:e.status))i((null==e?void 0:e.data)||"SUCCESS");else{const t=null==e?void 0:e.status,l=null==(s=null==e?void 0:e.data)?void 0:s.message;a||(console.error("PicX Error // ",e),void 0!==t&&void 0!==l&&u.error({duration:6e3,message:`Code: ${t}, Message: ${l}`})),i(null)}}))}))}ft.defaults.headers["Content-Type"]="application/json",ft.interceptors.request.use((e=>{var t;const a=mt("PICX_CONFIG");if(a){const{token:i}=a;(null==(t=e.baseURL)?void 0:t.includes(ht))&&i&&(e.headers.Authorization=`Bearer ${i}`)}return e}),(e=>Promise.reject(e))),ft.interceptors.response.use((e=>e),(e=>((null==e?void 0:e.response)||u.error({duration:6e3,message:`${e}`}),Promise.reject(e.response))));const bt=(e,t="")=>{const{owner:a,repo:i,branch:s}=e;return new Promise((async e=>{const l=await vt({url:`/repos/${a}/${i}/contents/${t}`,method:"GET",noShowErrMsg:!0,params:{ref:s}});l&&l.length?e(l.filter((e=>"dir"===e.type)).map((e=>({value:e.name,label:e.name})))):e([])}))},wt=(e,t="")=>{const{owner:a,repo:i,branch:s}=e;return new Promise((async e=>{const l=await vt({url:`/repos/${a}/${i}/contents/${t}`,method:"GET",noCache:!0,params:{ref:s}});l&&l.length?(l.filter((e=>"dir"===e.type)).forEach((e=>ia.dispatch("DIR_IMAGE_LIST_ADD_DIR",e.path))),setTimeout((()=>{l.filter((e=>"file"===e.type&&Pt($t(e.name)))).forEach((e=>{ia.dispatch("DIR_IMAGE_LIST_ADD_IMAGE",kt(e,t))}))}),120),e(!0)):e(null)}))},It=(e,t,a)=>vt({url:`/repos/${e}/${t}/branches/${a}`,method:"GET",noCache:!0}),St=async(e,t)=>{var a;const{owner:i,repo:s,branch:l}=e,n=g.service({text:Ne.global.t("settings_page.image_hosting_deploy.deploying")}),o=(e=!1)=>{t&&t(e),n.close()};try{const e=await((e,t)=>new Promise((async a=>{const i=await vt({url:`/repos/${e}/${t}/branches`,method:"GET",noCache:!0});i&&i.length?a(i.filter((e=>!e.protected)).map((e=>({value:e.name,label:e.name}))).reverse()):a([])})))(i,s),t=e.some((e=>"gh-pages"===e.value));let n=!0;if(t){n=!1;if(!(await ft.delete(`/repos/${i}/${s}/git/refs/heads/gh-pages`)))return void o(!1);n=!0}if(n){let e="";const t=await vt({url:`/repos/${i}/${s}/git/refs/heads/${l}`,method:"GET"});if(t&&(e=null==(a=null==t?void 0:t.object)?void 0:a.sha),!e)return void o(!1);(await vt({url:`/repos/${i}/${s}/git/refs`,method:"POST",data:{ref:"refs/heads/gh-pages",sha:e}})).object.sha?setTimeout((()=>{o(!0)}),5e4):o(!1)}}catch(r){console.error(r),o(!1)}},yt=(e,t,a,i)=>vt({url:`/repos/${e}/${t}/contents/${a}`,method:"DELETE",data:{owner:e,repo:t,path:a,message:"Delete image via PicX",sha:i}}),Et=(e,t,a)=>vt({url:`/repos/${t}/${a}/git/blobs`,method:"POST",data:{owner:t,repo:a,content:e,encoding:"base64"}}),Tt=(e,t,a,i)=>{var s,l,n;return vt({url:`/repos/${e}/${t}/git/trees`,method:"POST",data:{tree:a.map((e=>({path:e.path,mode:"100644",type:"blob",sha:e.sha}))),base_tree:(null==(n=null==(l=null==(s=null==i?void 0:i.commit)?void 0:s.commit)?void 0:l.tree)?void 0:n.sha)||null}})},Ot=(e,t,a,i,s)=>vt({url:`/repos/${e}/${t}/git/commits`,method:"POST",data:{tree:a.sha,parents:[i.commit.sha],message:s||"Upload images via PicX"}}),xt=(e,t,a,i)=>vt({url:`/repos/${e}/${t}/git/refs/heads/${a}`,method:"PATCH",data:{sha:i}}),kt=(e,t)=>({type:"image",uuid:ze(),dir:t,name:e.name,sha:e.sha,path:e.path,deleting:!1,size:e.size,checked:!1});const Lt=(e,t=!1)=>{e.forEach((e=>{e.deleting=t}))};async function At(e,t){if(1===e.length)return await async function(e,t){e.deleting=!0;const{owner:a,repo:i}=t,{path:s,sha:l}=e;return new Promise((async t=>{const n=await yt(a,i,s,l);e.deleting=!1,n?(t(!0),await ia.dispatch("UPLOAD_IMG_LIST_REMOVE",e.uuid),await ia.dispatch("DIR_IMAGE_LIST_REMOVE",e)):t(!1)}))}(e[0],t)?We.deleted:We.deleteFail;try{return await async function(e,t){Lt(e,!0);const{owner:a,repo:i,branch:s}=t,l=await It(a,i,s);if(!l)throw Lt(e,!1),new Error("获取分支信息失败");const n=await Tt(a,i,e.map((e=>({path:e.path,sha:null}))),l);if(!n)throw Lt(e,!1),new Error("创建 tree 失败");const o=await Ot(a,i,n,l);if(!o)throw Lt(e,!1),new Error("创建 commit 失败");if(!(await xt(a,i,s,o.sha)))throw Lt(e,!1),new Error("更新 ref 失败");e.forEach((e=>{e.deleting=!1,ia.dispatch("UPLOAD_IMG_LIST_REMOVE",e.uuid),ia.dispatch("DIR_IMAGE_LIST_REMOVE",e)}))}(e,t),We.allDeleted}catch(a){return console.error(a),We.deleteFail}}function Ct(e,t){const a=document.createElement("canvas"),i=a.getContext("2d"),s=new Image;return s.crossOrigin="Anonymous",s.src=e,new Promise((e=>{s.onload=()=>{const{width:l}=s,{height:n}=s;a.width=l,a.height=n,null==i||i.drawImage(s,0,0,l,n);const o=a.toDataURL(`image/${t}`);e(o)},s.onerror=()=>{e(null)}}))}function Dt(e){return new Promise((t=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>{const e=a.result;t(e)},a.onerror=()=>t(null)}))}const $t=e=>{const t=e.lastIndexOf(".");return e.slice(t+1)},Pt=e=>(e=e.toLowerCase(),/(png|jpg|jpeg|gif|webp|awebp|avif|svg\+xml|svg|x-icon|vnd.microsoft.icon)$/.test(e)),Ut=e=>e?Number((e/1024).toFixed(0)):e,Rt=e=>new Promise((async t=>{e||t(null),Pt(e.type)||(u.error(Ne.global.t("upload_page.tip_9",{name:e.name})),t(null));const a=await Dt(e)||"";Ut(a.length)>=30720&&(u.error(Ne.global.t("upload_page.tip_10",{name:e.name,size:30})),t(null)),t({uuid:ze(),base64:a,file:e})})),Gt=e=>{const t=f((()=>ia.getters.getUserConfigInfo)).value,a=f((()=>ia.getters.getUserSettings)).value,{selected:i}=a.imageLinkType,{rule:s}=a.imageLinkType.presetList[i];if(s){const{owner:a,repo:i,branch:l}=t;return s.replaceAll("{{owner}}",a).replaceAll("{{repo}}",i).replaceAll("{{branch}}",l).replaceAll("{{path}}",e.path)}return null},Mt=(e,t)=>{var a;const i=f((()=>ia.getters.getUserSettings)).value;if(i.imageLinkFormat.enable){const s=i.imageLinkFormat.selected,l=null==(a=i.imageLinkFormat.presetList.find((e=>e.name===s)))?void 0:a.format;if(l)return l.replaceAll("imageLink",e||"").replaceAll("imageName",t.split(".")[0])}return e},Nt=(e=!1)=>{const t=e?Ne.global.t("copy_success_1"):Ne.global.t("copy_success_2");u({type:e?"info":"success",message:t,duration:e?6e3:4e3})},jt=(e,t=!1)=>{const a=Mt(Gt(e),e.name);a?He(a,(()=>{Nt(t)})):u.error({message:Ne.global.t("copy_fail_1")})},zt=(e,t=!1)=>{if((null==e?void 0:e.length)>0){let a="";e.forEach(((t,i)=>{const s=Mt(Gt(t),t.name);a+=`${s}${i<e.length-1?"\n":""}`})),He(a,(()=>{Nt(t)}))}},Ht={state:{name:"dirImageListModule",dirObject:(()=>{const e=localStorage.getItem("PICX_MANAGEMENT");return e?JSON.parse(e):Pe("/","/")})()},mutations:{},actions:{DIR_IMAGE_LIST_ADD_DIR({state:e,dispatch:t},a){if("/"===a)return;const i=(e,t,a)=>{if(e){e.childrenDirs.some((e=>e.dir===t))||e.childrenDirs.push(Pe(t,a));return e.childrenDirs.find((e=>e.dir===t))||Pe(t,a)}return Pe(t,a)},s=a.split("/");let l="",n=e.dirObject;for(let o=0,r=s.length;o<r;o++){const e=s[o];l+=`${o>0?"/":""}${e}`,n=i(n,e,l),0===o&&t("USER_CONFIG_INFO_ADD_DIR",e)}t("DIR_IMAGE_LIST_PERSIST")},DIR_IMAGE_LIST_REMOVE_DIR({state:e,dispatch:t},a){if("/"===a)return;const i=a.split("/");let s=e.dirObject;i.forEach(((t,a)=>{s=((t,a,i)=>{if("/"===a)return e.dirObject;const s=t.childrenDirs.find((e=>e.dir===a));if(!s)return t;if(i){const e=t.childrenDirs.findIndex((e=>e.dir===a));-1!==e&&t.childrenDirs.splice(e,1)}return s})(s,t,a===i.length-1)})),t("DIR_IMAGE_LIST_PERSIST")},DIR_IMAGE_LIST_ADD_IMAGE({state:e,dispatch:t},a){let i=e.dirObject;if("/"===a.dir)i.imageList.some((e=>e.name===a.name))||i.imageList.push(a);else{const t=a.dir.split("/");let s="";t.forEach(((l,n)=>{s+=`${n>0?"/":""}${l}`,i=((t,a,i,s,l=!1)=>{var n;if(!t)return e.dirObject;let o=null==(n=t.childrenDirs)?void 0:n.find((e=>e.dir===a));return o||(o={type:"dir",dir:a,dirPath:i,childrenDirs:[],imageList:[]},t.childrenDirs.push(o)),l&&!o.imageList.some((e=>e.name===s.name))&&o.imageList.push(s),o})(i,l,s,a,n===t.length-1)}))}t("DIR_IMAGE_LIST_PERSIST")},DIR_IMAGE_LIST_REMOVE({state:e,dispatch:t},a){const i=(e,t)=>{if(e.length){const a=e.findIndex((e=>e.uuid===t));-1!==a&&e.splice(a,1)}},{dir:s,uuid:l}=a;if("/"===s)return i(e.dirObject.imageList,l),void t("DIR_IMAGE_LIST_PERSIST");const n=s.split("/");let o=e.dirObject;n.forEach(((s,l)=>{if(o=((t,a,s,l)=>{if(!t)return e.dirObject;const n=t.childrenDirs.find((e=>e.dir===a));return n?(n.dir===a&&l&&i(n.imageList,s.uuid),n):e.dirObject})(o,s,a,l===n.length-1),!o.imageList.length&&!o.childrenDirs.length){const a=(e=>{if("/"===e)return[];const t=e.split("/"),a=[];let i="";return t.forEach(((e,t)=>{i+=`${t>0?"/":""}${e}`,a.unshift(i)})),a})(o.dirPath);a.forEach((a=>{const i=Re(a,e.dirObject);if(i&&!i.imageList.length&&!i.childrenDirs.length){const{dirPath:e}=(e=>{if("/"===e)return{currentDir:"/",dirPath:"/"};const t=e.split("/");return 1===t.length?{currentDir:"/",dirPath:"/"}:t.length>1?(t.length-=1,{currentDir:t[t.length-1],dirPath:t.join("/")}):{currentDir:"/",dirPath:"/"}})(a),i=e,s=e;let l=s.split("/");"/"===e&&(l=[],t("USER_CONFIG_INFO_REMOVE_DIR",a)),t("SET_USER_CONFIG_INFO",{viewDir:i,selectedDir:s,selectedDirList:l}),t("DIR_IMAGE_LIST_REMOVE_DIR",a)}}))}}))},DIR_IMAGE_LIST_INIT_DIR({state:e,dispatch:t},a){let i=e.dirObject;if("/"===a)return i.imageList=[],i.childrenDirs=[],void t("DIR_IMAGE_LIST_PERSIST");const s=a.split("/");s.forEach(((t,a)=>{i=((t,a,i)=>{var s;if(!t)return e.dirObject;const l=null==(s=t.childrenDirs)?void 0:s.find((e=>e.dir===a));return l?(i&&(l.imageList=[],l.childrenDirs=[]),l):e.dirObject})(i,t,a===s.length-1)})),t("DIR_IMAGE_LIST_PERSIST")},DIR_IMAGE_LIST_PERSIST({state:e}){pt("PICX_MANAGEMENT",e.dirObject)},DIR_IMAGE_LOGOUT({state:e,dispatch:t}){e.dirObject=Pe("/","/"),t("DIR_IMAGE_LIST_PERSIST")}},getters:{getDirObject:e=>e.dirObject}},Ft=()=>{const e={token:"",id:"",owner:"",email:"",name:"",avatarUrl:"",repo:"",branch:"",selectedDir:"",dirMode:at.repoDir,dirList:[],logined:!1,selectedDirList:[],viewDir:"",repoPrivate:!1},t=localStorage.getItem("PICX_CONFIG");return t?(Ve(e,JSON.parse(t)),e.dirMode===at.dateDir&&(e.selectedDir=Be("yyyyMMdd")),e):e},Vt={state:{userConfigInfo:Ft()},actions:{USER_CONFIG_INFO_RESET({state:e}){e.userConfigInfo=Ft()},SET_USER_CONFIG_INFO({state:e,dispatch:t},a){for(const i in a)e.userConfigInfo.hasOwnProperty(i)&&(e.userConfigInfo[i]=a[i]);t("USER_CONFIG_INFO_PERSIST")},USER_CONFIG_INFO_ADD_DIR({state:e,dispatch:t},a){e.userConfigInfo.dirList.some((e=>e.value===a))||(e.userConfigInfo.dirList.push({label:a,value:a}),t("USER_CONFIG_INFO_PERSIST"))},USER_CONFIG_INFO_REMOVE_DIR({state:e,dispatch:t},a){const{dirList:i}=e.userConfigInfo;if(i.some((e=>e.value===a))){const e=i.findIndex((e=>e.value===a));i.splice(e,1),t("USER_CONFIG_INFO_PERSIST")}},USER_CONFIG_INFO_PERSIST({state:e}){(e=>{const{selectedDir:t,branch:a,dirMode:i}=e.userConfigInfo;if("newDir"===i){const a=t.split("");let i=0,s="";const l=[" ",".","、",",","，","!","？","?"];for(let e=0;e<a.length&&(l.some((t=>t===a[e]))&&(a[e]="-"),"/"===a[e]&&(i+=1),!(i>=5));e++)s+=a[e];e.userConfigInfo.selectedDir=s}e.userConfigInfo.branch=a.replace(/\s+/g,"-")})(e),localStorage.setItem("PICX_CONFIG",JSON.stringify(e.userConfigInfo))},USER_CONFIG_INFO_LOGOUT({state:e}){Fe(e.userConfigInfo)}},getters:{getUserLoginStatus:e=>e.userConfigInfo.logined,getUserConfigInfo:e=>e.userConfigInfo,getUserViewDir:e=>e.userConfigInfo.viewDir}},Bt={state:{imgCardArr:[]},mutations:{IMAGE_CARD(e,{imageObj:t}){const{uuid:a,checked:i}=t;i&&e.imgCardArr.forEach((e=>{e.uuid===a&&(e.checked=!0)}))},REPLACE_IMAGE_CARD(e,{checkedImgArr:t}){t.length>0?e.imgCardArr=t:e.imgCardArr=[]}},actions:{},getters:{getImageCardArr:e=>e.imgCardArr,getImageCardCheckedArr:e=>e.imgCardArr.filter((e=>e.checked))}},Xt={state:{isActive:!1,isPaste:!1,pressShiftKey:!1,activeInfo:null},mutations:{SET_UPLOAD_AREA_STATE(e,t){for(const a in t)e[a]=t[a]},UPLOAD_AREA_ACTIVE_LOGOUT(e){e.isActive=!1,e.isPaste=!1,e.pressShiftKey=!1,e.activeInfo=null}},getters:{getUploadAreaState:e=>e}};var qt,Jt;(Jt=qt||(qt={}))[Jt.add=0]="add",Jt[Jt.edit=1]="edit";const Kt=(e,t,a)=>{const i=t===qt.add?Ne.global.t("settings_page.link_rule.add"):Ne.global.t("settings_page.link_rule.edit"),s=[];if(!e.rule.includes("{{path}}"))return u.error(Ne.global.t("settings_page.link_rule.error_msg_2",{action:i,path:"{{path}}"})),void a(!1);if(e.rule.includes("{{owner}}")||s.push("{{owner}}"),e.rule.includes("{{repo}}")||s.push("{{repo}}"),e.rule.includes("{{branch}}")||s.push("{{branch}}"),s.length){const e=Ne.global.t("settings_page.link_rule.error_msg_3",{action:i,rules:s.join("、")});v.confirm(e,`${i}`,{type:"warning",showClose:t===qt.add,showCancelButton:t===qt.add}).then((()=>{a(!0)})).catch((()=>{a(!1)}))}else a(!0)},Wt={imageName:{enableHash:!0,addPrefix:{enable:!1,prefix:""}},compress:{enable:!0,encoder:Ye.webP},imageLinkType:{selected:et.GitHub,presetList:{[`${et.GitHubPages}`]:{id:ze(),name:et.GitHubPages,rule:"https://{{owner}}.github.io/{{repo}}/{{path}}"},[`${et.GitHub}`]:{id:ze(),name:et.GitHub,rule:"https://github.com/{{owner}}/{{repo}}/raw/{{branch}}/{{path}}"},[`${et.jsDelivr}`]:{id:ze(),name:et.jsDelivr,rule:"https://cdn.jsdelivr.net/gh/{{owner}}/{{repo}}@{{branch}}/{{path}}"},[`${et.Statically}`]:{id:ze(),name:et.Statically,rule:"https://cdn.statically.io/gh/{{owner}}/{{repo}}@{{branch}}/{{path}}"},[`${et.ChinaJsDelivr}`]:{id:ze(),name:et.ChinaJsDelivr,rule:"https://jsd.cdn.zzko.cn/gh/{{owner}}/{{repo}}@{{branch}}/{{path}}"}}},imageLinkFormat:{enable:!1,selected:"Markdown",presetList:[{name:"Markdown",format:"![imageName](imageLink)"},{name:"HTML",format:'<img src="imageLink" alt="imageName" />'},{name:"BBCode",format:"[img]imageLink[/img]"}]},starred:!1,watermark:{enable:!1,text:"PicX",fontSize:50,position:nt.rightBottom,textColor:"#FFFFFF",opacity:.5}},Zt={state:{userSettings:(()=>{const e=mt("PICX_SETTINGS");return e&&Ve(Wt,e),Wt})(),cloudSettings:null,globalSettings:(()=>{const e={folded:!1,elementPlusSize:st.default,language:ct.zhCN,languageToggleTip:!0,theme:rt.system,useCloudSettings:!1},t=(e=>{const t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null})("PICX_GLOBAL_SETTINGS");return t&&Ve(e,t),e})()},actions:{SET_USER_SETTINGS({state:e,dispatch:t},a){for(const i in a)Object.hasOwn(e.userSettings,i)&&(e.userSettings[i]=a[i]);t("USER_SETTINGS_PERSIST")},SET_CLOUD_SETTINGS({state:e},t){e.cloudSettings=t},SET_GLOBAL_SETTINGS({state:e},t){for(const a in t)e.globalSettings[a]=t[a];_t("PICX_GLOBAL_SETTINGS",e.globalSettings)},ADD_IMAGE_LINK_TYPE_RULE({state:e,dispatch:t},{rule:a}){const i=e.userSettings.imageLinkType.presetList;Object.hasOwn(i,a.name)?u.error(Ne.global.t("settings_page.link_rule.error_msg_1")):Kt(a,qt.add,(i=>{i&&(e.userSettings.imageLinkType.presetList[a.name]=a,t("USER_SETTINGS_PERSIST"))}))},UPDATE_IMAGE_LINK_TYPE_RULE({state:e,dispatch:t},{rule:a}){Kt(a,qt.edit,(i=>{i&&(e.userSettings.imageLinkType.presetList[a.name].rule=a.rule,t("USER_SETTINGS_PERSIST"))}))},DEL_IMAGE_LINK_TYPE_RULE({state:e,dispatch:t},a){delete e.userSettings.imageLinkType.presetList[a.name],t("USER_SETTINGS_PERSIST")},USER_SETTINGS_PERSIST({state:e}){pt("PICX_SETTINGS",e.userSettings)},USER_GLOBAL_PERSIST({state:e}){_t("PICX_GLOBAL_SETTINGS",e.globalSettings)},USER_SETTINGS_LOGOUT({state:e}){e.userSettings=Wt}},getters:{getUserSettings:e=>e.userSettings,getCloudSettings:e=>e.cloudSettings,getGlobalSettings:e=>e.globalSettings}},Yt={state:{toolboxImageList:[]},mutations:{},actions:{TOOLBOX_IMG_LIST_ADD({state:e},t){e.toolboxImageList.unshift(t)},TOOLBOX_IMG_LIST_REMOVE({state:e},t){if(e.toolboxImageList.length>0){const a=e.toolboxImageList.findIndex((e=>e.uuid===t));-1!==a&&e.toolboxImageList.splice(a,1)}},TOOLBOX_IMG_LIST_RESET({state:e}){e.toolboxImageList=[]}},getters:{getToolboxImageList:e=>e.toolboxImageList}},Qt={state:{uploadImageList:[]},mutations:{},actions:{UPLOAD_IMG_LIST_ADD({state:e},t){e.uploadImageList.unshift(t)},UPLOAD_IMG_LIST_REMOVE({state:e},t){if(e.uploadImageList.length>0){const a=e.uploadImageList.findIndex((e=>e.uuid===t));-1!==a&&0===e.uploadImageList[a].uploadStatus.progress&&e.uploadImageList.splice(a,1)}},UPLOAD_IMG_LIST_RESET({state:e}){e.uploadImageList=[]}},getters:{getUploadImageList:e=>e.uploadImageList}},ea={state:{authorizationInfo:(()=>{const e={authorized:!1,installed:null,token:"",tokenCreateTime:0,code:"",codeCreateTime:0,installationId:"",manualToken:"",isAutoAuthorize:!1,authorizing:!1},t=mt("PICX_AUTHORIZATION");return t?(Ve(e,t),e):e})()},actions:{SET_GITHUB_AUTHORIZATION_INFO({state:e,dispatch:t},a){for(const i in a)Object.hasOwn(e.authorizationInfo,i)&&(e.authorizationInfo[i]=a[i]);t("GITHUB_AUTHORIZATION_INFO_PERSIST")},GITHUB_AUTHORIZATION_INFO_PERSIST({state:e}){pt("PICX_AUTHORIZATION",e.authorizationInfo)}},getters:{getGitHubAuthorizationInfo:e=>e.authorizationInfo}};var ta,aa;(aa=ta||(ta={}))[aa.githubPages=0]="githubPages",aa[aa.vervel=1]="vervel";const ia=b({modules:{dirImageListModule:Ht,userConfigInfoModule:Vt,imageCardModule:Bt,uploadAreaModule:Xt,userSettingsModule:Zt,toolboxImageListModule:Yt,uploadImageListModule:Qt,githubAuthorizeModule:ea,deployStatusModule:{state:{github:{uuid:ze(),status:null,latestTime:null,type:ta.githubPages}},actions:{SET_DEPLOY_STATUS_INFO({state:e},t){Ve(e,t)}},getters:{getDeployStatusInfo:e=>e}}},state:{rootName:"root"},actions:{LOGOUT({dispatch:e,commit:t}){t("UPLOAD_AREA_ACTIVE_LOGOUT"),e("DIR_IMAGE_LOGOUT"),e("USER_CONFIG_INFO_LOGOUT"),e("USER_SETTINGS_LOGOUT"),e("TOOLBOX_IMG_LIST_RESET"),e("UPLOAD_IMG_LIST_RESET"),localStorage.clear(),sessionStorage.clear()}}}),sa=Symbol("vuex-store");function la(){return w(sa)}var na=(e,t)=>{const a=e.__vccOpts||e;for(const[i,s]of t)a[i]=s;return a};const oa=(e=>(D("data-v-3c85bfcd"),e=e(),$(),e))((()=>r("label",{for:"input-file-selector"},null,-1))),ra={key:0,class:"upload-area-tips"},da={class:"text"},ca=["src"];var ua=na(I({__name:"getting-images",props:{disabled:{type:Boolean,default:!1}},emits:["getImgList"],setup(e,{expose:t,emit:a}){const i=la(),s=f((()=>i.getters.getUploadAreaState)),l=S({uuid:"",base64:""}),d=S([]),c=a,u=()=>{const e=d.value.length,t=e>0?d.value[e-1]:{uuid:"",base64:""};l.value={uuid:t.uuid,base64:t.base64}},g=async e=>{if(e.length){d.value=[];for(const t of e){const e=await Rt(t);e&&d.value.push(e)}u(),i.commit("SET_UPLOAD_AREA_STATE",{isActive:!0}),c("getImgList",d.value)}},m=async e=>{const t=e.target;await g(t.files),t.value="",t.value=t.defaultValue},p=async e=>{await g(e.dataTransfer.files)},_=async e=>{const t=Array.from(e.clipboardData.items).filter((e=>"file"===e.kind&&Pt(e.type))).map((e=>e.getAsFile()));await g(t)};return y((()=>{window.addEventListener("paste",_)})),E((()=>{window.removeEventListener("paste",_)})),t({reset:()=>{d.value=[],l.value.uuid="",l.value.base64=""},remove:e=>{const t=d.value.findIndex((t=>t.uuid===e));-1!==t&&d.value.splice(t,1),e===l.value.uuid&&u()}}),(t,a)=>{const i=$e,d=T;return n(),o("div",{class:A(["getting-images-container",{focus:s.value.isActive&&l.value.base64,disabled:e.disabled}]),onDragover:a[0]||(a[0]=C((()=>{}),["prevent"])),onDrop:C(p,["stop","prevent"]),onPaste:C(_,["stop"])},[oa,r("input",{id:"input-file-selector",type:"file",accept:"image/*",onChange:m,multiple:"multiple"},null,32),l.value.base64?L("",!0):(n(),o("div",ra,[O(d,{class:"icon"},{default:x((()=>[O(i)])),_:1}),r("div",da,k(t.$t("upload_page.upload_area_text")),1)])),l.value.base64?(n(),o("img",{key:1,class:"preview-img",src:l.value.base64},null,8,ca)):L("",!0)],34)}}}),[["__scopeId","data-v-3c85bfcd"]]);const ga=f((()=>ia.getters.getUserSettings)).value,ma=(e,t,a)=>{var i;let s=a.selectedDir;(null==(i=null==t?void 0:t.reUploadInfo)?void 0:i.isReUpload)&&(s=t.reUploadInfo.dir),t.uploadStatus.progress=100,t.uploadStatus.uploading=!1;const l={checked:!1,type:"image",uuid:t.uuid,dir:s,name:e.name,sha:e.sha,path:e.path,deleting:!1,size:e.size};t.uploadedImg=l,ia.dispatch("DIR_IMAGE_LIST_ADD_DIR",s),ia.dispatch("DIR_IMAGE_LIST_ADD_IMAGE",l)};function pa(e,t){const{branch:a,email:i,owner:s}=e,l={message:"Upload image via PicX",branch:a,content:(t.base64.compressBase64||t.base64.watermarkBase64||t.base64.originalBase64).split(",")[1]};return i&&(l.committer={name:s,email:i}),t.uploadStatus.uploading=!0,new Promise((async a=>{const i=await((e,t)=>vt({url:e,method:"PUT",data:t}))(((e,t)=>{var a;const{owner:i,repo:s,selectedDir:l}=e,n=t.filename.final;let o=n;return"/"!==l&&(o=`${l}/${n}`),(null==(a=null==t?void 0:t.reUploadInfo)?void 0:a.isReUpload)&&(o=t.reUploadInfo.path),`/repos/${i}/${s}/contents/${o}`})(e,t),l);if(t.uploadStatus.uploading=!1,i){const{name:s,sha:l,path:n,size:o}=i.content;ma({name:s,sha:l,path:n,size:o},t,e),a(!0)}else a(!1)}))}const _a={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ha=[r("path",{fill:"currentColor",d:"M406.656 706.944L195.84 496.256a32 32 0 1 0-45.248 45.248l256 256l512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"},null,-1)];var fa={name:"ep-check",render:function(e,t){return n(),o("svg",_a,[...ha])}};const va={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ba=[r("path",{fill:"currentColor",d:"M160 832h704a32 32 0 1 1 0 64H160a32 32 0 1 1 0-64m384-578.304V704h-64V247.296L237.248 490.048L192 444.8L508.8 128l316.8 316.8l-45.312 45.248z"},null,-1)];var wa={name:"ep-upload",render:function(e,t){return n(),o("svg",va,[...ba])}};const Ia={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Sa=[r("path",{fill:"currentColor",d:"M352 480h320a32 32 0 1 1 0 64H352a32 32 0 0 1 0-64"},null,-1),r("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768a384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896a448 448 0 0 1 0 896"},null,-1)];var ya={name:"ep-remove",render:function(e,t){return n(),o("svg",Ia,[...Sa])}};const Ea={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Ta=[r("path",{fill:"currentColor",d:"M672 192L288 511.936L672 832z"},null,-1)];var Oa={name:"ep-caret-left",render:function(e,t){return n(),o("svg",Ea,[...Ta])}};const xa={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ka=[r("path",{fill:"currentColor",d:"m192 384l320 384l320-384z"},null,-1)];var La={name:"ep-caret-bottom",render:function(e,t){return n(),o("svg",xa,[...ka])}};const Aa=(e,t)=>{t.filename.isAddPrefix=e,t.filename.name=e?`${t.filename.prefix}${t.filename.initName}`:`${t.filename.initName}`,t.filename.isAddHash?t.filename.final=`${t.filename.name}.${t.filename.hash}.${t.filename.suffix}`:t.filename.final=`${t.filename.name}.${t.filename.suffix}`},Ca=(e,t)=>{t.filename.isAddHash=e,t.filename.final=e?`${t.filename.name}.${t.filename.hash}.${t.filename.suffix}`:`${t.filename.name}.${t.filename.suffix}`},Da=async(e,t)=>{const{watermark:a,compress:i}=t;let s=e.fileInfo.originalFile;var l;a.enable&&a.text&&!e.fileInfo.watermarkFile&&(e.beforeUploadStatus.watermarking=!0,e.fileInfo.watermarkFile=(l=(l=e.fileInfo.originalFile.type).toLowerCase(),/(png|jpg|jpeg|webp|avif)$/.test(l)?await gt(e.fileInfo.originalFile,a):e.fileInfo.originalFile),s=e.fileInfo.watermarkFile,e.base64.watermarkBase64=await Dt(s),e.beforeUploadStatus.watermarking=!1),i.enable&&!e.fileInfo.compressFile&&(e.beforeUploadStatus.compressing=!0,e.fileInfo.compressFile=await(async(e,t)=>{if(a=(a=e.type).toLowerCase(),/(png|jpg|jpeg|webp|avif)$/.test(a))return new m(e,{encoderState:{type:t,options:p[t].meta.defaultOptions},processorState:_,preprocessorState:h}).process();var a;return e})(s,i.encoder),s=e.fileInfo.compressFile,e.base64.compressBase64=await Dt(s),e.filename.suffix=$t(s.name),e.beforeUploadStatus.compressing=!1)};const $a=["element-loading-text"],Pa={class:"before-upload-handle-container"},Ua={class:"img-name text-ellipsis"},Ra={class:"operate-item"},Ga={class:"operate-item"},Ma={key:0,class:"operate-item"},Na={key:1,class:"img-info-box"},ja={class:"file-size-box"},za={key:0,class:"finial-file-size file-size-item"},Ha={class:"last-modified"};var Fa=na(I({__name:"upload-image-card",props:{imgObj:{type:Object,require:!0,default:()=>({})}},emits:["remove"],setup(e,{emit:t}){const a=la(),i=V(),s=e,l=t,d=f((()=>a.getters.getUserSettings)).value,c=S(null),u=S(""),g=P({isAddHash:!1,isAddPrefix:!1,isRename:!1,newName:""}),m=S(!0),p=()=>{var e,t;s.imgObj.filename.newName=g.newName,setTimeout((()=>{var e;null==(e=c.value)||e.focus()}),100),e=g.isRename,(t=s.imgObj).filename.isRename=e,e?t.filename.name=t.filename.newName.trim().replace(/\s+/g,"-"):Aa(t.filename.isAddPrefix,t),t.filename.isAddHash?t.filename.final=`${t.filename.name}.${t.filename.hash}.${t.filename.suffix}`:t.filename.final=`${t.filename.name}.${t.filename.suffix}`};return U((()=>s.imgObj.uploadStatus),(e=>{e.uploading&&(u.value=i.proxy.$t("upload_page.uploading"))}),{deep:!0,immediate:!0}),y((async()=>{await Da(s.imgObj,d),(()=>{const{imageName:e}=d;0===s.imgObj.uploadStatus.progress&&(s.imgObj.filename.isAddHash=e.enableHash,s.imgObj.filename.isAddPrefix=e.addPrefix.enable,s.imgObj.filename.prefix=e.addPrefix.prefix,Aa(e.addPrefix.enable,s.imgObj),Ca(e.enableHash,s.imgObj),g.isAddHash=s.imgObj.filename.isAddHash,g.isAddPrefix=s.imgObj.filename.isAddPrefix,g.isRename=s.imgObj.filename.isRename,g.newName=s.imgObj.filename.newName)})()})),(t,a)=>{var i,_,h,f,v,b,w,I;const S=R,y=La,E=Oa,C=T,D=G,$=M,P=N,U=ya,V=wa,B=fa,X=j;return n(),o("div",{class:A(["upload-image-card-container",{"wait-upload":!e.imgObj.uploadStatus.uploading&&0===e.imgObj.uploadStatus.progress,uploading:e.imgObj.uploadStatus.uploading&&100!==e.imgObj.uploadStatus.progress,uploaded:!e.imgObj.uploadStatus.uploading&&100===e.imgObj.uploadStatus.progress}])},[z((n(),o("div",{class:"img-show-container","element-loading-text":u.value},[O(S,{src:e.imgObj.base64.compressBase64||e.imgObj.base64.watermarkBase64||e.imgObj.base64.originalBase64,fit:"cover",loading:"lazy","hide-on-click-modal":!0,"preview-src-list":[e.imgObj.base64.compressBase64||e.imgObj.base64.watermarkBase64||e.imgObj.base64.originalBase64]},null,8,["src","preview-src-list"])],8,$a)),[[X,e.imgObj.uploadStatus.uploading||e.imgObj.beforeUploadStatus.compressing||e.imgObj.beforeUploadStatus.watermarking]]),r("div",Pa,[r("div",{class:A(["img-name-box",{"no-border":100===e.imgObj.uploadStatus.progress}])},[r("span",Ua,k(e.imgObj.filename.final||e.imgObj.filename.name),1),0===e.imgObj.uploadStatus.progress?(n(),H(D,{key:0,placement:"top",offset:8,content:m.value?t.$t("upload_page.expand"):t.$t("upload_page.fold")},{default:x((()=>[O(C,{class:"fold-btn",onClick:a[0]||(a[0]=e=>m.value=!m.value)},{default:x((()=>[m.value?L("",!0):(n(),H(y,{key:0})),m.value?(n(),H(E,{key:1})):L("",!0)])),_:1})])),_:1},8,["content"])):L("",!0)],2),0===e.imgObj.uploadStatus.progress?(n(),o("div",{key:0,class:A(["img-name-operate-box",{folded:m.value}])},[r("div",Ra,[O($,{label:t.$t("upload_page.add_hash"),modelValue:g.isAddHash,"onUpdate:modelValue":a[1]||(a[1]=e=>g.isAddHash=e),onChange:a[2]||(a[2]=e=>{Ca(e,s.imgObj)})},null,8,["label","modelValue"])]),r("div",Ga,[O($,{label:t.$t("rename"),modelValue:g.isRename,"onUpdate:modelValue":a[3]||(a[3]=e=>g.isRename=e),onChange:p},null,8,["label","modelValue"]),e.imgObj.filename.isRename?(n(),H(P,{key:0,class:"rename-input",size:"small",modelValue:g.newName,"onUpdate:modelValue":a[4]||(a[4]=e=>g.newName=e),onInput:p,maxlength:F(18),ref_key:"renameInputRef",ref:c,clearable:""},null,8,["modelValue","maxlength"])):L("",!0)]),!e.imgObj.filename.isRename&&F(d).imageName.addPrefix.enable&&F(d).imageName.addPrefix.prefix?(n(),o("div",Ma,[O($,{label:t.$t("upload_page.add_prefix"),modelValue:g.isAddPrefix,"onUpdate:modelValue":a[5]||(a[5]=e=>g.isAddPrefix=e),onChange:a[6]||(a[6]=e=>{Aa(e,s.imgObj)})},null,8,["label","modelValue"])])):L("",!0)],2)):L("",!0),0===e.imgObj.uploadStatus.progress?(n(),o("div",Na,[r("div",ja,[r("span",{class:A(["original-file-size file-size-item",{"del-line":null==(_=null==(i=e.imgObj.fileInfo)?void 0:i.compressFile)?void 0:_.size}])},k(F(Ut)(null==(h=e.imgObj.fileInfo.originalFile)?void 0:h.size))+" KB ",3),(null==(v=null==(f=e.imgObj.fileInfo)?void 0:f.compressFile)?void 0:v.size)?(n(),o("span",za,k(F(Ut)(null==(w=null==(b=e.imgObj.fileInfo)?void 0:b.compressFile)?void 0:w.size))+" KB ",1)):L("",!0)]),r("span",Ha,k(F(Be)("yyyy-MM-dd hh:mm",null==(I=e.imgObj.fileInfo.originalFile)?void 0:I.lastModified)),1)])):L("",!0)]),100===e.imgObj.uploadStatus.progress?(n(),o("div",{key:0,class:"after-upload-handle-container flex-center",onClick:a[7]||(a[7]=t=>F(jt)(e.imgObj.uploadedImg))},k(t.$t("copy_link")),1)):L("",!0),0===e.imgObj.uploadStatus.progress?(n(),H(D,{key:1,placement:"top",offset:8,content:t.$t("delete")},{default:x((()=>[O(C,{class:"del-img-btn",onClick:a[8]||(a[8]=t=>{return a=e.imgObj.uuid,void l("remove",a);var a})},{default:x((()=>[O(U)])),_:1})])),_:1},8,["content"])):L("",!0),r("div",{class:A(["upload-status-box",{"wait-upload":!e.imgObj.uploadStatus.uploading&&0===e.imgObj.uploadStatus.progress,uploaded:!e.imgObj.uploadStatus.uploading&&100===e.imgObj.uploadStatus.progress}])},[O(C,null,{default:x((()=>[e.imgObj.uploadStatus.uploading||0!==e.imgObj.uploadStatus.progress?L("",!0):(n(),H(V,{key:0})),e.imgObj.uploadStatus.uploading||100!==e.imgObj.uploadStatus.progress?L("",!0):(n(),H(B,{key:1}))])),_:1})],2)],2)}}}),[["__scopeId","data-v-70a9b57f"]]);const Va=I({__name:"repo-dir-cascader",props:{elKey:{type:String,default:""},elSize:{type:String,default:st.default},elWidth:{type:String,default:"100%"},elClearable:{type:Boolean,default:!1}},setup(e){const t=la(),a=f((()=>t.getters.getUserConfigInfo)).value,i={lazy:!0,checkStrictly:!0,async lazyLoad(e,t){const{level:i,pathLabels:s}=e;let l;l=0===i?a.dirList:await bt(a,s.join("/")),l.length?t(l.map((e=>({value:e.value,label:e.label,leaf:i>=4})))):t([])}},s=e=>{Array.isArray(e)&&e.length?(a.selectedDirList=e,a.selectedDir=e.join("/")):(a.selectedDirList=[],a.selectedDir=""),t.dispatch("USER_CONFIG_INFO_PERSIST")};return(t,l)=>{const o=B;return n(),H(o,{style:X({width:e.elWidth}),size:e.elSize,debounce:500,props:i,key:e.elKey,modelValue:F(a).selectedDirList,"onUpdate:modelValue":l[0]||(l[0]=e=>F(a).selectedDirList=e),filterable:"",placeholder:t.$t("config_page.placeholder_5"),clearable:e.elClearable,onChange:s},null,8,["style","size","modelValue","placeholder","clearable"])}}}),Ba={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Xa=[r("path",{fill:"currentColor",d:"M128 192v640h768V320H485.76L357.504 192zm-32-64h287.872l128.384 128H928a32 32 0 0 1 32 32v576a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32"},null,-1)];var qa={name:"ep-folder",render:function(e,t){return n(),o("svg",Ba,[...Xa])}};const Ja={key:0,class:"dir-info-bar border-box"};var Ka=na(I({__name:"dir-info-bar",setup(e){const t=la(),a=f((()=>t.getters.getUserConfigInfo)),i=f((()=>t.getters.getGlobalSettings)),s=()=>{tl.push("/")};return(e,t)=>{const l=qa,d=T,c=Va,u=q;return a.value.repo&&a.value.branch?(n(),o("div",Ja,[r("div",{class:"dir-name",onClick:s},[O(d,null,{default:x((()=>[O(l)])),_:1}),J(" "+k(e.$t("dir")),1)]),a.value.dirMode===F(at).repoDir?(n(),H(c,{key:0,"el-size":i.value.elementPlusSize===F(st).large?F(st).default:i.value.elementPlusSize,"el-clearable":!1},null,8,["el-size"])):(n(),H(u,{key:1,"disable-transitions":""},{default:x((()=>[J(k(a.value.selectedDir),1)])),_:1}))])):L("",!0)}}}),[["__scopeId","data-v-34edaca8"]]);const Wa={class:"upload-page-container"},Za={key:0,class:"upload-page-left page-container"},Ya={class:"row-item"},Qa={class:"content-box"},ei={class:"row-item"},ti={class:"content-box upload-area-status"},ai={key:0,class:"upload-count"},ii={key:0,class:"row-item"},si={class:"content-box operation-btn"},li={class:"shortcut-key"},ni={class:"shortcut-key"},oi=I({__name:"upload-image",setup(e){const t=V(),a=S(null),i=f((()=>ia.getters.getUserConfigInfo)).value,s=f((()=>ia.getters.getGlobalSettings)).value,d=f((()=>ia.getters.getUserLoginStatus)),c=S([]),g=S(!1),m=f((()=>"mac"===(()=>{const{platform:e}=navigator;return e.includes("Mac")?"mac":e.includes("Win")?"win":e.includes("Linux")?"linux":null})()?"⌘":"Ctrl")),p=S(!1),_=e=>{e.forEach((e=>{ia.dispatch("UPLOAD_IMG_LIST_ADD",(e=>{const t={uuid:"",base64:{originalBase64:"",watermarkBase64:null,compressBase64:null},fileInfo:{originalFile:null,watermarkFile:null,compressFile:null},filename:{hash:"",suffix:"",name:"",prefix:"",final:"",initName:"",newName:"",isAddHash:!0,isRename:!1,isAddPrefix:!1},beforeUploadStatus:{watermarking:!1,compressing:!1},uploadStatus:{progress:0,uploading:!1},reUploadInfo:{dir:"",path:"",isReUpload:!1}};t.uuid=e.uuid,t.base64.originalBase64=e.base64,t.fileInfo.originalFile=e.file;const{imageName:a}=ga,i=e.uuid,s=e.file.name.trim().replaceAll(" ","-"),l=s.lastIndexOf("."),n=s.slice(0,l),o=s.slice(l+1);return t.filename.initName=n,t.filename.name=a.addPrefix.enable?`${a.addPrefix.prefix}${n}`:n,t.filename.prefix=a.addPrefix.prefix,t.filename.hash=i,t.filename.suffix=o,t.filename.final=a.enableHash?`${t.filename.name}.${i}.${o}`:`${t.filename.name}.${o}`,t.filename.isAddHash=a.enableHash,t.filename.isAddPrefix=a.addPrefix.enable,t})(e))}))},h=()=>{var e;null==(e=a.value)||e.reset()},v=async e=>1===e.length?await pa(i,e[0])?Je.uploaded:Je.uploadFail:e.length>1?await async function(e,t){const{branch:a,repo:i,selectedDir:s,owner:n}=e,o=[];for(const m of t){m.uploadStatus.uploading=!0;const e=(m.base64.compressBase64||m.base64.watermarkBase64||m.base64.originalBase64).split(",")[1],t=await Et(e,n,i);t?o.push(l({img:m},t)):(m.uploadStatus.uploading=!1,u.error(Ne.global.t("upload_page.tip_11",{name:m.filename.final})))}const r=await It(n,i,a);if(!r)return Promise.resolve(!1);const d="/"===s?"":`${s}/`,c=await Tt(n,i,o.map((e=>({sha:e.sha,path:`${d}${e.img.filename.final}`}))),r);if(!c)return Promise.resolve(!1);const g=await Ot(n,i,c,r);return g&&await xt(n,i,a,g.sha)?(o.forEach((t=>{const a=t.img.filename.final;ma({name:a,sha:t.sha,path:`${d}${a}`,size:0},t.img,e)})),Promise.resolve(!0)):Promise.resolve(!1)}(i,e)?Je.allUploaded:Je.uploadFail:void 0,b=async(e,t=!1)=>{h(),t?zt(e,!0):jt(e[0],!0),await ia.dispatch("SET_USER_CONFIG_INFO",{viewDir:i.selectedDir})},w=async()=>{var e,a,s,l,n,o,r;const{token:d,repo:m,selectedDir:p}=i;if(!d)return u.error({message:null==(e=null==t?void 0:t.proxy)?void 0:e.$t("upload_page.message1")}),void(await tl.push("/"));if(!m)return u.error({message:null==(a=null==t?void 0:t.proxy)?void 0:a.$t("upload_page.message2")}),void(await tl.push("/"));if(!p)return u.error({message:null==(s=null==t?void 0:t.proxy)?void 0:s.$t("upload_page.message3")}),void(await tl.push("/"));const _=c.value.filter((e=>0===e.uploadStatus.progress));if(0===_.length)return void u.error({message:null==(l=null==t?void 0:t.proxy)?void 0:l.$t("upload_page.message4")});g.value=!0;const h=await v(_);g.value=!1;const f=_.filter((e=>100===e.uploadStatus.progress)).map((e=>e.uploadedImg));switch(h){case Je.uploaded:u.success({message:null==(n=null==t?void 0:t.proxy)?void 0:n.$t("upload_page.message5")}),await b(f);break;case Je.allUploaded:u.success({message:null==(o=null==t?void 0:t.proxy)?void 0:o.$t("upload_page.message6")}),await b(f,!0);break;case Je.uploadFail:u.error({message:null==(r=null==t?void 0:t.proxy)?void 0:r.$t("upload_page.message7")})}},I=()=>{g.value=!1,p.value=!1,ia.dispatch("UPLOAD_IMG_LIST_RESET"),h()};U((()=>d),(e=>{!e&&I()})),U((()=>ia.state.uploadImageListModule.uploadImageList),(e=>{c.value=e,p.value=c.value.some((e=>100===e.uploadStatus.progress))}),{immediate:!0,deep:!0});return y((()=>{document.addEventListener("keydown",(e=>{const t=e.keyCode||e.which||e.charCode,a=e.ctrlKey||e.metaKey;a&&65===t&&c.value.length&&(I(),e.preventDefault()),a&&83===t&&(g.value||(w(),e.preventDefault()))}))})),(e,t)=>{const i=ua,l=K;return n(),o("div",Wa,[c.value.length&&F(s).elementPlusSize!==F(st).small?(n(),o("div",Za,[(n(!0),o(W,null,Z(c.value,((e,i)=>(n(),o("div",{class:"uploaded-item",key:i+e.uuid},[O(Fa,{"img-obj":e,onRemove:t[0]||(t[0]=e=>{return t=e,ia.dispatch("UPLOAD_IMG_LIST_REMOVE",t),void(null==(i=a.value)||i.remove(t));var t,i})},null,8,["img-obj"])])))),128))])):L("",!0),r("div",{class:A(["upload-page-right page-container",{"has-left":c.value.length}])},[r("div",Ya,[r("div",Qa,[O(i,{disabled:g.value,ref_key:"gettingImagesRef",ref:a,onGetImgList:_},null,8,["disabled"])])]),r("div",ei,[r("div",ti,[O(Ka),c.value.length?(n(),o("span",ai,k(e.$t("uploaded"))+"："+k(c.value.filter((e=>100===e.uploadStatus.progress)).length)+" / "+k(c.value.length),1)):L("",!0)])]),c.value.length?(n(),o("div",ii,[r("div",si,[O(l,{disabled:g.value,plain:"",type:"warning",onClick:I},{default:x((()=>[J(k(e.$t("reset"))+" ",1),r("span",li,k(m.value)+" A",1)])),_:1},8,["disabled"]),O(l,{disabled:g.value,plain:"",type:"primary",onClick:w},{default:x((()=>[J(k(e.$t("upload"))+" ",1),r("span",ni,k(m.value)+" S",1)])),_:1},8,["disabled"])])])):L("",!0)],2)])}}});var ri,di;(di=ri||(ri={}))[di.save=0]="save",di[di.use=1]="use",di[di.update=2]="update",di[di.equal=3]="equal";const ci=async e=>{const{owner:t,repo:a}=e,i=await vt({url:`/repos/${t}/${t}/contents/.settings`,method:"GET",noShowErrMsg:!0,noCache:!0});return Promise.resolve(i)},ui={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},gi=[r("path",{fill:"currentColor",d:"M764.288 214.592L512 466.88L259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512L214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null,-1)];var mi={name:"ep-close",render:function(e,t){return n(),o("svg",ui,[...gi])}};var pi=na(I({__name:"cloud-settings-bar",setup(e){const t=Y({IEpCheck:fa,IEpClose:mi}),a=f((()=>ia.getters.getUserSettings)).value,i=f((()=>ia.getters.getUserConfigInfo)).value,s=S(!1),l=S(!1),d=S(ri.save),c=f((()=>{switch(d.value){case ri.save:return Ne.global.t("settings_page.cloud_settings.tip_1");case ri.use:return Ne.global.t("settings_page.cloud_settings.tip_2");case ri.update:return Ne.global.t("settings_page.cloud_settings.tip_3");case ri.equal:return Ne.global.t("settings_page.cloud_settings.tip_4");default:return Ne.global.t("settings_page.cloud_settings.tip_1")}})),g=S(!1),m=async()=>{s.value=!0,await(async(e,t)=>{const{owner:a,repo:i,branch:s}=t,l=await ci(t),n={message:l?"Update settings via PicX":"Init settings via PicX",content:window.btoa(JSON.stringify(e))};l?n.sha=l.sha:n.branch=s;const o=await vt({url:`/repos/${a}/${i}/contents/.settings`,method:"PUT",data:n,noShowErrMsg:!0});return Promise.resolve(o)})(a,i),s.value=!1,u.success(null===ia.getters.getCloudSettings?Ne.global.t("settings_page.cloud_settings.success_msg_1"):Ne.global.t("settings_page.cloud_settings.success_msg_2")),await ia.dispatch("SET_CLOUD_SETTINGS",JSON.parse(JSON.stringify(a)))},p=()=>{switch(d.value){case ri.save:case ri.update:m();break;case ri.use:ia.getters.getCloudSettings&&(Ve(a,ia.getters.getCloudSettings),ia.dispatch("USER_SETTINGS_PERSIST"),ia.dispatch("SET_GLOBAL_SETTINGS",{useCloudSettings:!0}))}};return U((()=>a),(e=>{ia.getters.getCloudSettings&&(qe(e,ia.getters.getCloudSettings)?(d.value=ri.equal,l.value=!0):(d.value=ri.update,l.value=!1))}),{deep:!0}),U((()=>ia.getters.getCloudSettings),(e=>{e?ia.getters.getGlobalSettings.useCloudSettings?qe(e,a)?(l.value=!0,d.value=ri.equal):(l.value=!1,d.value=ri.update):qe(e,a)?(l.value=!0,d.value=ri.equal):(l.value=!1,d.value=ri.use):d.value=ri.save}),{deep:!0,immediate:!0}),y((()=>{(async()=>{const e=await ci(i);g.value=!0,await ia.dispatch("SET_CLOUD_SETTINGS",e?JSON.parse(window.atob(e.content)):null)})()})),(e,a)=>{const i=K;return g.value?(n(),o("div",{key:0,class:A(["cloud-settings-data-box status-bar info",{warning:d.value===F(ri).update,success:d.value===F(ri).equal}])},[r("div",null,k(c.value),1),O(i,{type:"primary",text:"",icon:t.value.IEpCheck,loading:s.value,disabled:l.value,onClick:p},{default:x((()=>[J(k(e.$t("confirm")),1)])),_:1},8,["icon","loading","disabled"])],2)):L("",!0)}}}),[["__scopeId","data-v-7d0d4b5d"]]);const _i=f((()=>ia.getters.getUserConfigInfo)).value,hi=f((()=>ia.getters.getDeployStatusInfo)).value,fi=async()=>{const{owner:e,repo:t,branch:a}=_i;if(!e||!t||!a)return null;const i=await vt({url:`/repos/${e}/${t}/contents/.deploy`,method:"GET",noShowErrMsg:!0,noCache:!0,params:{branch:a}});return Promise.resolve(i)},vi=e=>{switch(e){case ta.githubPages:return"GitHub Pages";case ta.vervel:return"Vercel";default:return"GitHub Pages"}};const bi={class:"deploy-status-bar-box border-box"},wi={class:"left-wrap flex-start"},Ii={key:0,class:"deploy-datetime info-item"},Si={class:"deploy-server info-item"},yi={class:"deploy-status info-item"},Ei={class:"right-wrap"};var Ti=na(I({__name:"deploy-status-bar",props:{disabled:{type:Boolean,default:!1}},setup(e){const t=f((()=>ia.getters.getUserSettings)).value,a=f((()=>ia.getters.getUserConfigInfo)).value,i=f((()=>ia.getters.getDeployStatusInfo)).value,s=e=>{switch(e.type){case ta.githubPages:return void St(a,(e=>{i.github.status=e,i.github.latestTime=Date.now(),(async()=>{const{owner:e,repo:t,branch:a}=_i,i=await fi(),s={message:i?"Update deploy status via PicX":"Init deploy status via PicX",content:window.btoa(JSON.stringify(hi))};i?s.sha=i.sha:s.branch=a;const l=await vt({url:`/repos/${e}/${t}/contents/.deploy`,method:"PUT",data:s,noShowErrMsg:!0});Promise.resolve(l)})(),e?(t.imageLinkType.selected=et.GitHubPages,ia.dispatch("USER_SETTINGS_PERSIST"),u.success(Ne.global.t("settings_page.image_hosting_deploy.success"))):u.error(Ne.global.t("settings_page.image_hosting_deploy.fail2"))}));case ta.vervel:}};return(t,a)=>{const l=K;return n(),o("div",bi,[(n(!0),o(W,null,Z(F(i),((a,i)=>(n(),o("div",{class:"deploy-item status-bar info",key:i+a.uuid},[r("div",wi,[r("span",{class:A(["deploy-status-icon info-item",{success:!0===a.status,fail:!1===a.status}])},null,2),a.latestTime?(n(),o("span",Ii,k(F(Be)("yyyy-MM-dd hh:mm:ss",a.latestTime)),1)):L("",!0),r("span",Si,k(F(vi)(a.type)),1),r("span",yi,k(null===a.status?t.$t("settings_page.image_hosting_deploy.not_deployed"):!0===a.status?t.$t("settings_page.image_hosting_deploy.success"):t.$t("settings_page.image_hosting_deploy.fail")),1)]),r("div",Ei,[O(l,{type:"primary",disabled:e.disabled,text:"",onClick:e=>s(a)},{default:x((()=>[J(k(t.$t("settings_page.image_hosting_deploy.one_click_deploy")),1)])),_:2},1032,["disabled","onClick"])])])))),128))])}}}),[["__scopeId","data-v-045d61c6"]]);const Oi={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},xi=[r("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32zm448-64v-64H416v64zM224 896h576V256H224zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32m192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32"},null,-1)];var ki={name:"ep-delete",render:function(e,t){return n(),o("svg",Oi,[...xi])}};const Li={class:"card-header"},Ai=["onFocusout"],Ci={style:{"margin-top":"20px"}};var Di=na(I({__name:"image-link-rule-config",setup(e){const t=V(),a=f((()=>ia.getters.getUserSettings)).value,i=f((()=>{const e=[];for(const t in a.imageLinkType.presetList)e.push(a.imageLinkType.presetList[t]);return e})),s=S(),l=P({id:"",name:"",rule:"",editable:!0});return(e,a)=>{const o=Q,d=ki,c=K,u=ee,g=te,m=N,p=ae,_=ie,h=se;return n(),H(h,null,{header:x((()=>[r("div",Li,[r("span",null,k(e.$t("settings_page.link_rule.card_title")),1)])])),default:x((()=>[O(u,{data:i.value,style:{width:"100%"}},{default:x((()=>[O(o,{prop:"name",label:e.$t("settings_page.link_rule.card_table_col_title_1"),width:"120"},null,8,["label"]),O(o,{label:e.$t("settings_page.link_rule.card_table_col_title_2")},{default:x((e=>[r("div",{contenteditable:!0,onFocusout:t=>((e,t)=>{const a=JSON.parse(JSON.stringify(t));a.rule=e,ia.dispatch("UPDATE_IMAGE_LINK_TYPE_RULE",{rule:a})})(t.target.innerHTML,e.row)},k(e.row.rule),41,Ai)])),_:1},8,["label"]),O(o,{label:e.$t("settings_page.link_rule.card_table_col_title_3"),width:"80",align:"center"},{default:x((e=>[O(c,{link:"",size:"small",disabled:!e.row.editable,onClick:a=>{return i=e.row,void v.confirm(`${null==(s=null==t?void 0:t.proxy)?void 0:s.$t("settings_page.link_format.delete_tips")}：<strong>${i.name}</strong>`,null==(l=null==t?void 0:t.proxy)?void 0:l.$t("tip"),{dangerouslyUseHTMLString:!0,type:"warning"}).then((()=>{ia.dispatch("DEL_IMAGE_LINK_TYPE_RULE",i)})).catch((()=>{}));var i,s,l}},{default:x((()=>[O(d)])),_:2},1032,["disabled","onClick"])])),_:1},8,["label"])])),_:1},8,["data"]),O(g),r("div",Ci,[O(_,{ref_key:"formRef",ref:s,"label-position":"left",model:l,"label-width":"120px",size:"default"},{default:x((()=>[O(p,{label:e.$t("settings_page.link_rule.input_name_1"),prop:"name",rules:[{required:!0,message:e.$t("settings_page.link_rule.input_name_1_rule")}]},{default:x((()=>[O(m,{modelValue:l.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.name=e),type:"text"},null,8,["modelValue"])])),_:1},8,["label","rules"]),O(p,{label:e.$t("settings_page.link_rule.input_name_2"),prop:"rule",rules:[{required:!0,message:e.$t("settings_page.link_rule.input_name_2_rule")}]},{default:x((()=>[O(m,{modelValue:l.rule,"onUpdate:modelValue":a[1]||(a[1]=e=>l.rule=e),type:"text"},null,8,["modelValue"])])),_:1},8,["label","rules"]),O(p,null,{default:x((()=>[O(c,{type:"primary",disabled:!l.name||!l.rule,onClick:a[2]||(a[2]=e=>{var t;(t=s.value)&&t.validate((e=>{e&&(l.id=ze(),ia.dispatch("ADD_IMAGE_LINK_TYPE_RULE",{rule:JSON.parse(JSON.stringify(l))}))}))})},{default:x((()=>[J(k(e.$t("settings_page.link_rule.btn_name_1")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"])])])),_:1})}}}),[["__scopeId","data-v-42167a2f"]]);const $i={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Pi=[r("path",{fill:"currentColor",d:"M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z"},null,-1)];var Ui={name:"ep-refresh",render:function(e,t){return n(),o("svg",$i,[...Pi])}};const Ri={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Gi=[r("path",{fill:"currentColor",d:"M640 384v64H448a128 128 0 0 0-128 128v128a128 128 0 0 0 128 128h320a128 128 0 0 0 128-128V576a128 128 0 0 0-64-110.848V394.88c74.56 26.368 128 97.472 128 181.056v128a192 192 0 0 1-192 192H448a192 192 0 0 1-192-192V576a192 192 0 0 1 192-192z"},null,-1),r("path",{fill:"currentColor",d:"M384 640v-64h192a128 128 0 0 0 128-128V320a128 128 0 0 0-128-128H256a128 128 0 0 0-128 128v128a128 128 0 0 0 64 110.848v70.272A192.06 192.06 0 0 1 64 448V320a192 192 0 0 1 192-192h320a192 192 0 0 1 192 192v128a192 192 0 0 1-192 192z"},null,-1)];var Mi={name:"ep-connection",render:function(e,t){return n(),o("svg",Ri,[...Gi])}};const Ni={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ji=[r("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384a192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512a256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"},null,-1)];var zi={name:"ep-user",render:function(e,t){return n(),o("svg",Ni,[...ji])}};const Hi=f((()=>ia.getters.getUserConfigInfo)).value,Fi=async()=>{await ia.dispatch("USER_CONFIG_INFO_PERSIST")};const Vi=async e=>{Hi.repo=Hi.owner;const{token:t}=Hi;if(!t)return u.error({message:Ne.global.t("config_page.message_1")}),void(null==e||e.focus());const a=g.service({lock:!0,text:Ne.global.t("config_page.loading_6")});try{const e=await(e=>vt({url:"/user",method:"GET",headers:{Authorization:`Bearer ${e}`}}))(Hi.token);if(!e)return a.close(),void u.error({message:Ne.global.t("config_page.message_2")});ia.getters.getGitHubAuthorizationInfo.isAutoAuthorize||await ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{manualToken:Hi.token}),await async function(e){await ia.dispatch("SET_USER_CONFIG_INFO",{logined:!0,id:e.id,owner:e.login,name:e.name,email:e.email,avatarUrl:e.avatar_url})}(e);let t=!1;Hi.repo=Hi.owner;const i=await((e,t,a)=>vt({url:`/repos/${t}/${a}`,method:"GET",noCache:!0,success422:!0,noShowErrMsg:!0,headers:{Authorization:`Bearer ${e}`}}))(Hi.token,Hi.owner,Hi.owner);i&&(t=!0,await ia.dispatch("SET_USER_CONFIG_INFO",{repoPrivate:i.private})),Hi.repo;const s=await((e,t)=>vt({url:"/user/repos",method:"POST",data:{name:t,description:"PicX images hosting repository",private:!1},headers:{Authorization:`Bearer ${e}`},success422:!0,noShowErrMsg:!0}))(Hi.token,Hi.repo),l=f((()=>ia.getters.getGitHubAuthorizationInfo)).value,{token:n,authorized:o}=l;if(await(async(e,t,a)=>{var i;if(t&&a)if(e)await ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{installed:!0});else{const e=u({customClass:"custom-message-container",duration:0,offset:20,type:"warning",message:`<div class="content-box authorization">\n                    <span class="msg">${Ne.global.t("authorization.msg_2")}</span>\n                    <spna class="btn-box">\n                      <span class="confirm btn">${Ne.global.t("authorization.btn_1")}</span>\n                    </spna>\n                  </div>`,dangerouslyUseHTMLString:!0});null==(i=document.querySelector(".custom-message-container .authorization .confirm"))||i.addEventListener("click",(()=>{e.close();let t="https://github.com/apps/picx-app/installations/select_target";Hi.id&&(t="https://github.com/apps/picx-app/installations/new/permissions?target_id="+Hi.id),window.location.href=t}))}})(s,o,n),!s)return a.close(),void(o&&n||u.error({message:Ne.global.t("config_page.message_3")}));Hi.branch="main",t&&(Hi.dirList=await bt(Hi)),Hi.dirMode=at.rootDir,Hi.selectedDir="/",t||await(async e=>{const{owner:t,repo:a,branch:i}=e;await vt({url:`/repos/${t}/${a}/contents/README.md`,method:"PUT",data:{message:"Init repo via PicX",branch:i,content:window.btoa("")},noShowErrMsg:!0})})(Hi),await Fi(),a.close(),u.success({message:Ne.global.t("config_page.message_4")}),await tl.push("/upload")}catch(i){u.error({message:Ne.global.t("config_page.message_5")}),console.error("oneClickAutoConfig >> ",i)}},Bi=()=>{const{tokenCreateTime:e}=f((()=>ia.getters.getGitHubAuthorizationInfo)).value;return Date.now()-e>432e6},Xi=()=>{window.location.href="https://github.com/login/oauth/authorize?client_id=Iv1.0c2864ff02d09e2d&redirect_uri=https://beyondxinxin.github.io/picx/#/"};const qi={class:"page-container config-page-container"},Ji={key:0},Ki={key:1},Wi={class:"cell-item"},Zi={type:"primary"},Yi={class:"cell-item"},Qi={type:"primary"},es={class:"cell-item"},ts={class:"dir-box border-box"},as={key:1,class:"dir-item"},is={class:"setting-list"},ss={class:"setting-item cdn"},ls={class:"left"},ns={class:"right"},os={class:"setting-item",style:{"margin-top":"20rem"}},rs={key:0,class:"row-item"},ds={key:1,class:"row-item"};var cs,us,gs=na(I({__name:"picx-config",setup(e){const t=la(),a=S(32),i=f((()=>t.getters.getUserConfigInfo)).value,s=f((()=>t.getters.getGlobalSettings)).value;S(null);const d=S(null),m=S("repoDirCascaderKey"),p=f((()=>t.getters.getUserSettings)).value,_=f((()=>t.getters.getDeployStatusInfo)).value,h=S(!1),b=f((()=>t.getters.getGitHubAuthorizationInfo)).value,w=e=>{switch(e){case at.dateDir:i.selectedDir=Be("yyyyMMdd");break;case at.repoDir:i.selectedDir="",i.selectedDirList.length&&(i.selectedDir=i.selectedDirList.join("/"));break;default:i.selectedDir="/"}Fi()},I=async()=>{const e=g.service({lock:!0,text:Ne.global.t("config_page.loading_4")});i.dirList=await bt(i),e.close(),await t.dispatch("USER_CONFIG_INFO_PERSIST")},E=()=>{t.dispatch("SET_USER_SETTINGS",l({},p))},A=()=>{h.value=!0,t.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{isAutoAuthorize:!0});const{authorized:e,installed:a,token:i}=b;e&&a&&i&&!Bi()?(t.dispatch("SET_USER_CONFIG_INFO",{token:i}),tl.push("/")):Xi()};return y((()=>{(async()=>{var e;const t=new URLSearchParams(window.location.search),a=t.get("code"),i=t.get("setup_action"),s=t.get("installation_id");if("install"===i&&s&&!a&&(await ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{installed:!0,installationId:s}),v.confirm(Ne.global.t("authorization.msg_3"),Ne.global.t("tip"),{confirmButtonText:Ne.global.t("confirm"),cancelButtonText:Ne.global.t("cancel"),type:"success",draggable:!0}).then((()=>{Xi()})).catch((()=>{window.location.href="/"}))),a){const t=g.service({lock:!0,text:Ne.global.t("authorization.loading_1")});try{await ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{authorized:!0,code:a,codeCreateTime:Date.now(),isAutoAuthorize:!0});const{token:i}=f((()=>ia.getters.getGitHubAuthorizationInfo)).value;let s="";if(!i||i&&Bi()){const t=await c.get(`http://112.126.73.204:5678/api/github-authorize?code=${a}`);(null==(e=t.data)?void 0:e.token)?(s=t.data.token,await ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{token:s,tokenCreateTime:Date.now()})):u.error({message:t.data.msg,duration:6e3})}else s=i;if(s){await ia.dispatch("SET_USER_CONFIG_INFO",{token:s}),t.close();const e=window.location.href.replace(window.location.search,"");window.location.href=`${e}config?auto=1`}t.close()}catch(l){t.close(),u.error({message:Ne.global.t("authorization.msg_4"),duration:6e3})}}})(),setTimeout((()=>{var e;i.token&&"1"!==tl.currentRoute.value.query.focus||null==(e=d.value)||e.focus(),(()=>{const{token:e,isAutoAuthorize:a}=f((()=>t.getters.getGitHubAuthorizationInfo)).value;a&&e&&!Bi()&&tl.currentRoute.value.query.auto&&Vi(d.value)})()}),100)})),(e,t)=>{const l=K,d=zi,c=T,u=le,g=Mi,f=qa,v=ne,b=oe,S=N,y=Va,C=Ui,D=re,$=de,P=ce,U=ue,R=Di,G=ge,M=Ti,j=pi;return n(),o("div",qi,[F(i).token?L("",!0):(n(),o("div",Ji,[O(l,{class:"row-item",plain:"",type:"primary",onClick:A,size:"large",loading:h.value},{default:x((()=>[J(k(e.$t("authorization.text_1")),1)])),_:1},8,["loading"])])),F(i).token?(n(),o("div",Ki,[O(G,{class:"row-item"},{default:x((()=>[O($,{title:"基本信息",name:"0"},{default:x((()=>[F(i).token?(n(),H(D,{key:0,class:"row-item",column:1,border:""},{default:x((()=>[F(i).owner?(n(),H(u,{key:0},{label:x((()=>[r("div",Wi,[O(c,null,{default:x((()=>[O(d)])),_:1}),J(" "+k(e.$t("username")),1)])])),default:x((()=>[r("div",Zi,k(F(i).owner),1)])),_:1})):L("",!0),F(i).repo?(n(),H(u,{key:1},{label:x((()=>[r("div",Yi,[O(c,null,{default:x((()=>[O(g)])),_:1}),J(" "+k(e.$t("repo")),1)])])),default:x((()=>[r("div",Qi,k(F(i).repo),1)])),_:1})):L("",!0),F(i).repo&&F(i).branch?(n(),H(u,{key:2,span:2},{label:x((()=>[r("div",es,[O(c,null,{default:x((()=>[O(f)])),_:1}),J(" "+k(e.$t("dir")),1)])])),default:x((()=>[r("div",ts,[O(b,{class:"dir-item",modelValue:F(i).dirMode,"onUpdate:modelValue":t[0]||(t[0]=e=>F(i).dirMode=e),onChange:w},{default:x((()=>[O(v,{label:"dateDir"},{default:x((()=>[J(k(e.$t("config_page.date_dir")),1)])),_:1}),F(i).dirList.length?(n(),H(v,{key:0,label:"repoDir"},{default:x((()=>[J(k(e.$t("config_page.repo_dir")),1)])),_:1})):L("",!0)])),_:1},8,["modelValue"]),F(i).dirMode===F(at).dateDir?(n(),H(S,{key:0,class:"dir-item",modelValue:F(i).selectedDir,"onUpdate:modelValue":t[1]||(t[1]=e=>F(i).selectedDir=e),readonly:""},null,8,["modelValue"])):L("",!0),F(i).dirMode===F(at).repoDir?(n(),o("div",as,[O(y,{"el-key":m.value,"el-size":F(s).elementPlusSize,"el-clearable":!0,style:X({width:"calc(100% - "+a.value+"rem)"})},null,8,["el-key","el-size","style"]),O(c,{class:"refresh-icon",style:X({width:a.value+"rem"}),onClick:I},{default:x((()=>[O(C)])),_:1},8,["style"])])):L("",!0)])])),_:1})):L("",!0)])),_:1})):L("",!0)])),_:1}),O($,{title:e.$t("settings_page.link_rule.title"),name:"4"},{default:x((()=>[r("ul",is,[r("li",ss,[J(k(e.$t("settings_page.link_rule.select_title"))+"： ",1),O(U,{modelValue:F(p).imageLinkType.selected,"onUpdate:modelValue":t[2]||(t[2]=e=>F(p).imageLinkType.selected=e),onChange:E},{default:x((()=>[(n(!0),o(W,null,Z(F(p).imageLinkType.presetList,(e=>{return n(),H(P,{key:e.name+"-"+e.id,label:e.name,value:e.name,disabled:(t=e.name,t===et.GitHubPages&&!_.github.status),class:"image-link-type-rule-option"},{default:x((()=>[r("span",ls,k(e.name),1),r("span",ns,k(e.rule),1)])),_:2},1032,["label","value","disabled"]);var t})),128))])),_:1},8,["modelValue"])]),r("li",os,[O(R)])])])),_:1},8,["title"])])),_:1}),F(i).logined?(n(),o("div",rs,[O(M)])):L("",!0),F(i).logined?(n(),o("div",ds,[O(j)])):L("",!0)])):L("",!0)])}}}),[["__scopeId","data-v-fdcbd222"]]);(us=cs||(cs={}))[us.dirArea=0]="dirArea",us[us.dir=1]="dir",us[us.img=2]="img",us[us.uploadArea=3]="uploadArea";const ms={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ps=[r("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64z"},null,-1),r("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64"},null,-1)];var _s={name:"ep-copy-document",render:function(e,t){return n(),o("svg",ms,[...ps])}};const hs={key:0,class:"selector-wrapper"},fs={class:"selector-left-box"},vs={class:"item"},bs={class:"selector-right-box"};var ws=na(I({__name:"image-selector",props:{currentDirImageList:{type:Array,default:()=>[]}},emits:["updateInitImageList"],setup(e){const t=e,a=la(),i=S(!1),s=V(),l=f((()=>a.getters.getImageCardCheckedArr)),d=f((()=>a.getters.getUserConfigInfo)).value,c=f((()=>l.value.length||0));U((()=>c.value),(e=>{const a=t.currentDirImageList.length;i.value=e===a}));const g=()=>{zt(l.value)},m=()=>{t.currentDirImageList.forEach((e=>{e.checked&&(e.checked=!1)}))},p=()=>{var e,t,a,i;(null==(e=l.value)?void 0:e.length)>0&&v.confirm(null==(a=null==s?void 0:s.proxy)?void 0:a.$t("management_page.delTips2",{total:null==(t=l.value)?void 0:t.length}),null==(i=null==s?void 0:s.proxy)?void 0:i.$t("tip"),{type:"warning"}).then((async()=>{var e,t,a;const i=await At(l.value,d);i===We.deleted&&u.success({message:null==(e=null==s?void 0:s.proxy)?void 0:e.$t("management_page.message5")}),i===We.allDeleted&&u.success({message:null==(t=null==s?void 0:s.proxy)?void 0:t.$t("management_page.message6")}),i===We.deleteFail&&u.error({message:null==(a=null==s?void 0:s.proxy)?void 0:a.$t("management_page.message7")})})).catch((()=>{}))},_=()=>{let e=[];t.currentDirImageList.forEach((e=>{e.checked=i.value})),e=t.currentDirImageList,a.commit("REPLACE_IMAGE_CARD",{checkedImgArr:e})};return y((()=>{_()})),(e,t)=>{const a=M,s=_s,l=T,d=G,u=ki;return c.value?(n(),o("div",hs,[r("div",fs,[O(a,{label:i.value?e.$t("management_page.deselectAll"):e.$t("management_page.selectAll"),modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),onChange:_},null,8,["label","modelValue"]),r("div",vs,k(e.$t("management_page.selectTotal",{total:c.value})),1),r("div",{class:"item cancel-select-btn",onClick:m},k(e.$t("management_page.unselect")),1)]),r("div",bs,[O(d,{placement:"top",content:e.$t("management_page.batchCopy"),"show-arrow":!1,offset:6},{default:x((()=>[O(l,{class:"btn-icon",onClick:g},{default:x((()=>[O(s)])),_:1})])),_:1},8,["content"]),O(d,{placement:"top",content:e.$t("management_page.batchDelete"),"show-arrow":!1,offset:6},{default:x((()=>[O(l,{class:"btn-icon",onClick:p},{default:x((()=>[O(u)])),_:1})])),_:1},8,["content"])])])):L("",!0)}}}),[["__scopeId","data-v-e8fb5f2c"]]);const Is={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Ss=[r("path",{fill:"currentColor",d:"M128 320v576h576V320zm-32-64h640a32 32 0 0 1 32 32v640a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V288a32 32 0 0 1 32-32M960 96v704a32 32 0 0 1-32 32h-96v-64h64V128H384v64h-64V96a32 32 0 0 1 32-32h576a32 32 0 0 1 32 32M256 672h320v64H256zm0-192h320v64H256z"},null,-1)];var ys={name:"ep-document-copy",render:function(e,t){return n(),o("svg",Is,[...Ss])}};let Es=0,Ts=0;const Os=[],xs=async(e,t,a,i)=>{const{owner:s}=f((()=>ia.getters.getUserConfigInfo)).value,l=await vt({method:"GET",noShowErrMsg:!0,url:`repos/${s}/${e}/contents/${a}`,params:{ref:t}});if(Es+=1,l){if(Array.isArray(l)&&l.length){Ts+=l.length;for(const a of l)await xs(e,t,a.path)}if("dir"===(null==l?void 0:l.type)&&await xs(e,t,l.path),"file"===(null==l?void 0:l.type)&&Pt(l.name)){let e=null==l?void 0:l.content;if(!e){const t=await Ct(l.download_url,$t(l.name)),a=null==t?void 0:t.split(",")[1];a&&(e=a)}Os.push({name:l.name,path:l.path,content:e,sha:l.sha,download_url:l.download_url})}Es>Ts&&i&&i({status:!0,imgList:Os})}else i&&i({status:!1,imgList:Os})};const ks={class:"copy-source-repo border-box"};var Ls=na(I({__name:"copy-source-repo",props:{position:{type:String,default:"config"}},setup(e){const t=S(!1),a=S(),i=S(),s=S(),d=S(!1),c=P({status:!1,text:""}),g=P({repo:"",branch:""}),m=()=>{var e,t,a;g.repo?g.branch?null==(a=i.value)||a.focus():null==(t=s.value)||t.focus():null==(e=i.value)||e.focus()},p=async()=>{a.value.validate((async e=>{e?(d.value=!0,await xs(g.repo,g.branch,"",(async({status:e,imgList:t})=>{if(e){const e=await(async(e,t)=>{const{branch:a,repo:i,owner:s}=f((()=>ia.getters.getUserConfigInfo)).value,n=[];for(const c of e){const e=await Et(c.content,s,i);e?n.push(l({img:c},e)):u.error(Ne.global.t("upload_page.tip_11",{name:c.name}))}const o=await It(s,i,a);if(!o)return Promise.resolve(!1);const r=await Tt(s,i,n.map((e=>({sha:e.sha,path:e.img.path}))),o);if(!r)return Promise.resolve(!1);const d=await Ot(s,i,r,o,`Copy \`${t}\` image${e.length?"s":""} via PicX`);return d&&await xt(s,i,a,d.sha)?Promise.resolve(!0):Promise.resolve(!1)})(t,g.repo);d.value=!1,e?(c.status=!0,c.text=Ne.global.t("copy_repo_img.text_6",{repo:g.repo}),await(async()=>{const e=f((()=>ia.getters.getUserConfigInfo)).value;await ia.dispatch("SET_USER_CONFIG_INFO",{viewDir:"/"}),await ia.dispatch("DIR_IMAGE_LIST_INIT_DIR","/"),await wt(e,"/")})()):(c.status=!1,c.text=Ne.global.t("copy_repo_img.text_7",{repo:g.repo}))}else d.value=!1,c.status=!1,c.text=Ne.global.t("copy_repo_img.text_4"),m()}))):m()}))},_=()=>{var e;c.status=!1,c.text="",null==(e=a.value)||e.clearValidate()};return U((()=>g),(()=>{c.status=!1,c.text=""}),{deep:!0}),U((()=>t.value),(e=>{e&&setTimeout((()=>{m()}),100)}),{immediate:!0}),(l,u)=>{const m=ys,h=T,f=G,v=me,b=pe,w=N,I=ae,S=ie,y=K,E=_e;return n(),o(W,null,[O(f,{placement:"top",disabled:"management"!==e.position,content:l.$t("copy_repo_img.text_8"),"show-arrow":!1,offset:6},{default:x((()=>[O(h,{class:A(["copy-source-repo-icon",[e.position]]),onClick:u[0]||(u[0]=e=>t.value=!0)},{default:x((()=>[O(m)])),_:1},8,["class"])])),_:1},8,["disabled","content"]),O(E,{modelValue:t.value,"onUpdate:modelValue":u[4]||(u[4]=e=>t.value=e),width:"500",title:l.$t("copy_repo_img.text_1"),draggable:"","show-close":!d.value,"close-on-click-modal":!d.value,onClose:_},{footer:x((()=>[d.value?L("",!0):(n(),H(y,{key:0,onClick:u[3]||(u[3]=e=>t.value=!1)},{default:x((()=>[J(k(l.$t("cancel")),1)])),_:1})),O(y,{type:"primary",onClick:p,loading:d.value,disabled:c.status},{default:x((()=>[J(k(d.value?l.$t("copy_repo_img.loading_1"):l.$t("confirm")),1)])),_:1},8,["loading","disabled"])])),default:x((()=>[r("div",ks,[c.text?(n(),H(v,{key:0,class:"copy-result-tip",title:c.text,type:c.status?"success":"error","show-icon":"",closable:!1},null,8,["title","type"])):L("",!0),d.value?(n(),H(b,{key:1,class:"copy-progress","stroke-width":6,percentage:50,duration:2,indeterminate:!0,"show-text":!1})):L("",!0),O(S,{ref_key:"formRef",ref:a,"label-width":"90","label-position":"left",model:g,disabled:d.value},{default:x((()=>[O(I,{label:l.$t("repo"),prop:"repo",rules:[{required:!0,message:l.$t("copy_repo_img.text_2")}]},{default:x((()=>[O(w,{ref_key:"sourceRepoRef",ref:i,modelValue:g.repo,"onUpdate:modelValue":u[1]||(u[1]=e=>g.repo=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label","rules"]),O(I,{label:l.$t("branch"),prop:"branch",rules:[{required:!0,message:l.$t("copy_repo_img.text_3")}]},{default:x((()=>[O(w,{ref_key:"sourceRepoBranchRef",ref:s,modelValue:g.branch,"onUpdate:modelValue":u[2]||(u[2]=e=>g.branch=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["model","disabled"])])])),_:1},8,["modelValue","title","show-close","close-on-click-modal"])],64)}}}),[["__scopeId","data-v-642e5961"]]);const As={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Cs=[r("path",{fill:"currentColor",d:"M685.248 104.704a64 64 0 0 1 0 90.496L368.448 512l316.8 316.8a64 64 0 0 1-90.496 90.496L232.704 557.248a64 64 0 0 1 0-90.496l362.048-362.048a64 64 0 0 1 90.496 0"},null,-1)];var Ds={name:"ep-arrow-left-bold",render:function(e,t){return n(),o("svg",As,[...Cs])}};const $s={class:"tools-bar border-box"},Ps={class:"left flex-start"},Us={class:"dir-info flex-start"},Rs={class:"right flex-end"};var Gs=na(I({__name:"tools-bar",emits:["reload"],setup(e,{emit:t}){const a=t,i=f((()=>ia.getters.getUserConfigInfo)).value,s=()=>{const e=i.viewDir;if("/"===e)return;const t=e.split("/");1===t.length?i.viewDir="/":t.length>1&&(t.length-=1,i.viewDir=t.join("/")),ia.dispatch("USER_CONFIG_INFO_PERSIST")};return(e,t)=>{const l=Ds,d=T,c=K,u=qa,g=Ls,m=Ui,p=G;return n(),o("div",$s,[r("div",Ps,[O(c,{text:"",circle:"",disabled:"/"===F(i).viewDir,onClick:s},{default:x((()=>[O(d,{size:18},{default:x((()=>[O(l)])),_:1})])),_:1},8,["disabled"]),r("div",Us,[O(d,null,{default:x((()=>[O(u)])),_:1}),J(" "+k(F(i).viewDir.split("/").join(" / ")),1)])]),r("div",Rs,[O(g,{position:"management"}),O(p,{placement:"top",content:e.$t("management_page.reload"),"show-arrow":!1,offset:6},{default:x((()=>[O(d,{class:"btn-icon",onClick:t[0]||(t[0]=C((e=>a("reload")),["stop"]))},{default:x((()=>[O(m)])),_:1})])),_:1},8,["content"])])])}}}),[["__scopeId","data-v-0b0f309a"]]);const Ms=(e=>(D("data-v-bc35e904"),e=e(),$(),e))((()=>r("div",{class:"icon"},[r("svg",{t:"1639999626518",class:"icon",viewBox:"0 0 1228 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3575",width:"200",height:"200"},[r("path",{d:"M1196.987733 212.5824v540.0576c0 39.594667-34.474667 71.3728-76.765866 71.3728H323.242667c-51.780267 0-88.746667-46.762667-73.250134-92.808533l126.737067-375.808H70.417067C31.675733 355.362133 0 326.4512 0 291.089067V98.372267C0 63.044267 31.675733 34.0992 70.417067 34.0992h378.811733c26.7264 0 51.029333 13.9264 63.010133 35.703467l39.048534 71.406933H1120.256c42.257067 0 76.8 32.119467 76.8 71.3728",fill:"#5398DF","p-id":"3576"}),r("path",{d:"M1128.721067 997.853867H68.266667a68.266667 68.266667 0 0 1-68.266667-68.266667V280.3712a68.266667 68.266667 0 0 1 68.266667-68.266667h1060.4544a68.266667 68.266667 0 0 1 68.266666 68.266667V929.5872a68.266667 68.266667 0 0 1-68.266666 68.266667",fill:"#85BCFF","p-id":"3577"})])],-1))),Ns={class:"text"};var js=na(I({__name:"folder-card",props:{folderObj:{type:Object,default:()=>{}}},setup(e){const t=f((()=>ia.getters.getUserConfigInfo)).value,a=e,i=()=>{t.viewDir=a.folderObj.dirPath,ia.dispatch("USER_CONFIG_INFO_PERSIST")};return(t,a)=>{const s=he("contextmenu");return z((n(),o("div",{class:A(["folder-card border-box",{active:e.folderObj.active}]),onDblclick:i},[Ms,r("div",Ns,k(e.folderObj.dir),1)],34)),[[s,{type:F(cs).dir,dir:e.folderObj.dir}]])}}}),[["__scopeId","data-v-bc35e904"]]);const zs={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Hs=[r("path",{fill:"currentColor",d:"M77.248 415.04a64 64 0 0 1 90.496 0l226.304 226.304L846.528 188.8a64 64 0 1 1 90.56 90.496l-543.04 543.04l-316.8-316.8a64 64 0 0 1 0-90.496"},null,-1)];var Fs={name:"ep-select",render:function(e,t){return n(),o("svg",zs,[...Hs])}};const Vs=["element-loading-text"],Bs={class:"image-card-top border-box"},Xs={class:"image-card-bottom border-box"},qs={class:"filename text-ellipsis border-box"};var Js=na(I({__name:"image-card",props:{imageObj:{type:Object,default:()=>({})},isUploaded:{type:Boolean,default:!1}},setup(e){const t=e,a=f((()=>Gt(t.imageObj))),i=S(!1),s=e=>{e.checked=!e.checked,ia.commit("IMAGE_CARD",{imageObj:e})};return(t,l)=>{const d=R,c=Fs,u=T,g=j,m=he("contextmenu");return z((n(),o("div",{class:A(["image-card border-box",{checked:e.imageObj.checked,active:e.imageObj.active}]),"element-loading-text":t.$t("management_page.loadingTxt3"),onMouseenter:l[2]||(l[2]=e=>i.value=!0),onMouseleave:l[3]||(l[3]=e=>i.value=!1),onClick:l[4]||(l[4]=C((t=>{return a=e.imageObj,void s(a);var a}),["shift"])),ref:"imageCardRef"},[r("div",Bs,[O(d,{src:a.value,fit:"cover",loading:"lazy",lazy:"","hide-on-click-modal":!0,"preview-src-list":F(ia).getters.getUploadAreaState.pressShiftKey?[]:[a.value]},null,8,["src","preview-src-list"])]),r("div",Xs,[r("div",qs,k(e.imageObj.name),1),r("div",{class:"copy-link text-ellipsis border-box",onClick:l[0]||(l[0]=t=>F(jt)(e.imageObj))},k(t.$t("copy_link")),1)]),z(r("div",{class:"checked-box flex-center",onClick:l[1]||(l[1]=t=>s(e.imageObj))},[e.imageObj.checked?(n(),H(u,{key:0,size:14},{default:x((()=>[O(c)])),_:1})):L("",!0)],512),[[fe,i.value||e.imageObj.checked]])],42,Vs)),[[g,e.imageObj.deleting],[m,{type:F(cs).img,img:e.imageObj}]])}}}),[["__scopeId","data-v-8fa8ae64"]]);const Ks={class:"page-container management-page-container"},Ws={class:"top-box border-box"},Zs=["element-loading-text"],Ys={key:0,class:"dir-card-list list-item border-box"},Qs={key:1,class:"image-card-list list-item border-box"};const el=[{path:"/",name:"config",component:gs,meta:{title:"nav.config"}},{path:"/upload",name:"upload",component:oi,meta:{title:"nav.upload"}},{path:"/management",name:"Management",component:na(I({__name:"imgs-management",setup(e){const t=la(),a=f((()=>t.getters.getUserConfigInfo)).value,i=f((()=>t.getters.getDirObject)).value,s=S((new Date).getTime()),l=S(!1),d=S([]),c=S([]),u=S(!1);async function g(e){l.value=!0;const s=Re(e,i);if(s){const i=Ge(s,"dir"),l=Ge(s,"image");i.length||l.length?(d.value=i,c.value=l,t.commit("REPLACE_IMAGE_CARD",{checkedImgArr:c.value})):await wt(a,e)}else await wt(a,e);l.value=!1}async function m(){const{viewDir:e}=a;await t.dispatch("DIR_IMAGE_LIST_INIT_DIR",e),l.value=!0,await wt(a,e),l.value=!1}return y((()=>{document.addEventListener("keydown",(e=>{16===(e.keyCode||e.which||e.charCode)&&ia.commit("SET_UPLOAD_AREA_STATE",{pressShiftKey:!0})})),document.addEventListener("keyup",(e=>{16===(e.keyCode||e.which||e.charCode)&&ia.commit("SET_UPLOAD_AREA_STATE",{pressShiftKey:!1})})),async function(){const{selectedDir:e,viewDir:t,dirMode:s}=a;""===t&&(s!==at.newDir&&s!==at.dateDir||Re(e,i)||(a.selectedDir="/",a.dirMode="rootDir"),a.selectedDir?a.viewDir=a.selectedDir:a.viewDir="/"),i.imageList.length||i.childrenDirs.length?await g(a.viewDir):await wt(a,a.viewDir)}()})),U((()=>a.viewDir),(async e=>{await g(e),s.value+=1}),{deep:!0}),U((()=>i),(e=>{const{viewDir:i}=a,s=Re(i,e);s&&(d.value=Ge(s,"dir"),c.value=Ge(s,"image"),t.commit("REPLACE_IMAGE_CARD",{checkedImgArr:c.value}))}),{deep:!0}),U((()=>c.value),(e=>{u.value=e.filter((e=>e.checked)).length>0}),{deep:!0}),U((()=>t.getters.getUploadAreaState.activeInfo),(e=>{const{type:t,dir:a,img:i}=e||{};c.value.forEach((e=>{e.active=t===cs.img&&e.name===(null==i?void 0:i.name)})),d.value.forEach((e=>{e.active=t===cs.dir&&e.dir===a}))}),{deep:!0}),(e,t)=>{const a=K,i=ve,g=he("contextmenu"),p=j;return n(),o("div",Ks,[r("div",Ws,[O(Gs,{onReload:m})]),z((n(),o("div",{class:"bottom-box border-box","element-loading-text":e.$t("management_page.loadingTxt1")},[c.value.length?(n(),H(ws,{currentDirImageList:c.value,onUpdateInitImageList:c.value,key:s.value},null,8,["currentDirImageList","onUpdateInitImageList"])):L("",!0),z((n(),o("div",{class:A(["content-list-box border-box",{"has-tools":u.value}])},[d.value.length?(n(),o("ul",Ys,[(n(!0),o(W,null,Z(d.value,((e,t)=>(n(),o("li",{class:"dir-card-item border-box",key:"folder-card-"+e.dir+"-"+t},[O(js,{class:A("folder-card-"+t),"folder-obj":e},null,8,["class","folder-obj"])])))),128))])):L("",!0),c.value.length?(n(),o("ul",Qs,[(n(!0),o(W,null,Z(c.value,((e,t)=>(n(),o("li",{class:"image-card-item border-box",key:"image-card-"+t},[O(Js,{"image-obj":e},null,8,["image-obj"])])))),128))])):L("",!0),c.value.length||d.value.length?L("",!0):(n(),H(i,{key:2},{default:x((()=>[O(a,{type:"primary",onClick:t[0]||(t[0]=e=>F(tl).push("/upload"))},{default:x((()=>[J(k(e.$t("management_page.text_2")),1)])),_:1})])),_:1}))],2)),[[g,{type:F(cs).dirArea}]])],8,Zs)),[[p,l.value]])])}}}),[["__scopeId","data-v-2abb87f4"]]),meta:{title:"nav.management"}},{path:"/:catchAll(.*)",redirect:"/"}],tl=be({history:we(),routes:el});tl.beforeEach(((e,t,a)=>{e.meta.title&&Xe(e.meta.title),a()}));const al=()=>{const e=la(),t=async e=>{await Ie((()=>{const t=document.getElementsByTagName("html")[0];e===rt.dark&&(t.classList.remove("light"),t.classList.add("dark")),e===rt.light&&(t.classList.remove("dark"),t.classList.add("light"))}))},a=async e=>{e===rt.system?await t(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?rt.dark:rt.light):await t(e)};U((()=>e.getters.getGlobalSettings.theme),(async e=>{await a(e)}),{deep:!0,immediate:!0})},il={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},sl=[r("path",{fill:"currentColor",d:"M288 320a224 224 0 1 0 448 0a224 224 0 1 0-448 0m544 608H160a32 32 0 0 1-32-32v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 0 1-32 32z"},null,-1)];var ll={name:"ep-user-filled",render:function(e,t){return n(),o("svg",il,[...sl])}};const nl={class:"avatar flex-center"},ol=["src","alt"],rl={class:"personal-center-popover border-box"},dl={class:"user-info border-box"},cl={key:0,class:"info-item name"};var ul=na(I({__name:"user-avatar-v2",setup(e){const t=Se(),a=la(),i=f((()=>a.getters.getUserConfigInfo)).value;f((()=>a.getters.getGlobalSettings)).value;const s=()=>{a.dispatch("LOGOUT"),t.push("/login"),document.body.click(),setTimeout((()=>{window.location.reload()}))};return(e,t)=>{const l=ll,d=T,c=La,u=ye;return F(i).logined?(n(),H(u,{key:0,placement:"bottom-end",trigger:"click",width:"240rem","show-arrow":!1,"popper-style":{padding:"0","border-radius":"10rem",overflow:"hidden"}},{reference:x((()=>{var e,t,s;return[r("div",{class:A(["user-avatar-v2 border-box",{folded:F(a).getters.getGlobalSettings.folded}])},[r("div",nl,[(null==(e=F(i))?void 0:e.avatarUrl)?(n(),o("img",{key:0,src:null==(t=F(i))?void 0:t.avatarUrl,alt:null==(s=F(i))?void 0:s.owner},null,8,ol)):(n(),H(d,{key:1,class:"user-filled-icon"},{default:x((()=>[O(l)])),_:1}))]),O(d,{class:"popover-tip-icon"},{default:x((()=>[O(c)])),_:1})],2)]})),default:x((()=>[r("ul",rl,[r("li",dl,[F(i).owner?(n(),o("div",cl,k(F(i).owner),1)):L("",!0)]),F(i).name||F(i).owner?(n(),o("li",{key:0,class:"content-item border-box",onClick:s},k(e.$t("logout")),1)):L("",!0)])])),_:1})):L("",!0)}}}),[["__scopeId","data-v-56e08b96"]]);const gl={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ml=[r("path",{fill:"currentColor",d:"M389.44 768a96.064 96.064 0 0 1 181.12 0H896v64H570.56a96.064 96.064 0 0 1-181.12 0H128v-64zm192-288a96.064 96.064 0 0 1 181.12 0H896v64H762.56a96.064 96.064 0 0 1-181.12 0H128v-64zm-320-288a96.064 96.064 0 0 1 181.12 0H896v64H442.56a96.064 96.064 0 0 1-181.12 0H128v-64z"},null,-1)];var pl={name:"ep-operation",render:function(e,t){return n(),o("svg",gl,[...ml])}};const _l={class:"quick-actions-popover"},hl=I({__name:"quick-actions",setup(e){const t=f((()=>ia.getters.getUserSettings)).value,a=f((()=>ia.getters.getGlobalSettings)).value,i=()=>{ia.dispatch("USER_SETTINGS_PERSIST")};return(e,s)=>{const l=pl,o=T,d=K,c=Ee,u=ye;return n(),H(u,{placement:"bottom-end",width:"en"===F(a).language?"230rem":"190rem",trigger:"click","show-arrow":!1,"popper-style":{padding:"0","border-radius":"10rem",overflow:"hidden"}},{reference:x((()=>[O(d,{circle:"",text:""},{default:x((()=>[O(o,{size:22},{default:x((()=>[O(l)])),_:1})])),_:1})])),default:x((()=>[r("div",_l,[O(c,{modelValue:F(t).watermark.enable,"onUpdate:modelValue":s[0]||(s[0]=e=>F(t).watermark.enable=e),"active-text":e.$t("actions.watermark"),onChange:i},null,8,["modelValue","active-text"]),O(c,{modelValue:F(t).compress.enable,"onUpdate:modelValue":s[1]||(s[1]=e=>F(t).compress.enable=e),"active-text":e.$t("actions.compress"),onChange:i},null,8,["modelValue","active-text"]),O(c,{modelValue:F(t).imageLinkFormat.enable,"onUpdate:modelValue":s[2]||(s[2]=e=>F(t).imageLinkFormat.enable=e),"active-text":e.$t("actions.transform")+F(t).imageLinkFormat.selected,onChange:i},null,8,["modelValue","active-text"])])])),_:1},8,["width"])}}});const fl={class:"header-content-box border-box"},vl={class:"header-left border-box"},bl={class:"brand-box"},wl=[(e=>(D("data-v-4817f097"),e=e(),$(),e))((()=>r("img",{src:"./assets/logo.ffee4291.png",alt:"PicX"},null,-1)))],Il={class:"header-right"},Sl={key:0,class:"btn-item"},yl={class:"btn-item avatar"};var El=na(I({__name:"header-content",setup(e){const t=f((()=>ia.getters.getUserConfigInfo));return(e,a)=>{const i=hl,s=ul;return n(),o("header",fl,[r("div",vl,[r("div",bl,[r("div",{class:"logo",onClick:a[0]||(a[0]=e=>F(tl).push("/"))},wl),r("div",{class:"title",onClick:a[1]||(a[1]=e=>F(tl).push("/"))},"PicX")])]),r("div",Il,[t.value.logined?(n(),o("div",Sl,[O(i)])):L("",!0),r("div",yl,[O(s)])])])}}}),[["__scopeId","data-v-4817f097"]]);const Tl={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Ol=[r("path",{fill:"currentColor",d:"M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640z"},null,-1),r("path",{fill:"currentColor",d:"m469.952 554.24l52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"},null,-1)];var xl={name:"ep-edit",render:function(e,t){return n(),o("svg",Tl,[...Ol])}};const kl={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Ll=[r("path",{fill:"currentColor",d:"M160 160v704h704V160zm-32-64h768a32 32 0 0 1 32 32v768a32 32 0 0 1-32 32H128a32 32 0 0 1-32-32V128a32 32 0 0 1 32-32"},null,-1),r("path",{fill:"currentColor",d:"M384 288q64 0 64 64t-64 64t-64-64t64-64M185.408 876.992l-50.816-38.912L350.72 556.032a96 96 0 0 1 134.592-17.856l1.856 1.472l122.88 99.136a32 32 0 0 0 44.992-4.864l216-269.888l49.92 39.936l-215.808 269.824l-.256.32a96 96 0 0 1-135.04 14.464l-122.88-99.072l-.64-.512a32 32 0 0 0-44.8 5.952z"},null,-1)];var Al={name:"ep-picture",render:function(e,t){return n(),o("svg",kl,[...Ll])}};const Cl=Y([{uuid:ze(),name:"nav.config",icon:xl,isActive:!1,path:"/",isShow:!0},{uuid:ze(),name:"nav.upload",icon:wa,isActive:!1,path:"/upload",isShow:!0},{uuid:ze(),name:"nav.management",icon:Al,isActive:!1,path:"/management",isShow:!0}]);const Dl={class:"top-box border-box"},$l={class:"nav-menu-list border-box"},Pl=["onClick"],Ul={class:"nav-name"};var Rl=na(I({__name:"nav-content",setup(e){const t=Se(),a=la(),i=f((()=>a.getters.getUserConfigInfo)).value,s=f((()=>a.getters.getGlobalSettings)).value,l=f((()=>{switch(s.elementPlusSize){case st.small:return 21;case st.large:return 25;default:return 23}})),d=e=>{Cl.value.forEach((t=>{const a=t;return a.isActive=t.path===e||e.includes(t.path),a})),Te(Cl)};return U((()=>t.currentRoute.value),(e=>{d(e.path)})),U((()=>i.logined),(e=>{Cl.value.forEach((t=>{switch(t.path){case"/management":case"/upload":t.isShow=e}}))}),{deep:!0,immediate:!0}),y((()=>{t.isReady().then((()=>{d(t.currentRoute.value.path)}))})),(e,s)=>{const d=T,c=G;return n(),o("aside",{class:A(["nav-content-container border-box",{folded:F(a).getters.getGlobalSettings.folded}])},[r("div",Dl,[r("ul",$l,[(n(!0),o(W,null,Z(F(Cl),((s,o)=>(n(),H(c,{placement:"left",content:e.$t(s.name),key:o+s.uuid,"show-arrow":!1,disabled:!F(a).getters.getGlobalSettings.folded},{default:x((()=>[z(r("li",{class:A(["nav-menu-item border-box",{active:s.isActive}]),onClick:e=>(e=>{const{path:a}=e;if("/management"===a){if(""===i.repo)return u.warning(Ne.global.t("upload_page.message2")),void t.push("/");if(""===i.selectedDir)return u.warning(Ne.global.t("upload_page.message3")),void t.push("/")}t.push(a)})(s)},[O(d,{class:"nav-icon",size:l.value},{default:x((()=>[(n(),H(Oe(s.icon)))])),_:2},1032,["size"]),r("span",Ul,k(e.$t(s.name)),1)],10,Pl),[[fe,s.isShow]])])),_:2},1032,["content","disabled"])))),128))])])],2)}}}),[["__scopeId","data-v-70bfc4e9"]]);const Gl={class:"main-container"},Ml={class:"top-container border-box"},Nl={class:"bottom-container border-box"},jl={class:"bottom-right-box border-box"};var zl=na(I({__name:"main-container",setup(e){const t=async()=>{const e=await fi();e&&await(async e=>{await ia.dispatch("SET_DEPLOY_STATUS_INFO",JSON.parse(window.atob(e)))})(e.content)};return y((()=>{al(),t()})),(e,t)=>{const a=xe("router-view");return n(),o("main",Gl,[r("div",Ml,[O(El)]),r("div",Nl,[r("div",{class:A(["bottom-left-box border-box",{folded:F(ia).getters.getGlobalSettings.folded}])},[O(Rl)],2),r("div",jl,[O(a)])])])}}}),[["__scopeId","data-v-6506b35d"]]);const Hl=I({__name:"app-wrap",setup(e){const t=V(),a=la(),i=f((()=>a.getters.getGlobalSettings)).value,s=S(st.default),l=S(Le),o=e=>{e<=700?(null==a||a.dispatch("SET_GLOBAL_SETTINGS",{elementPlusSize:st.small,folded:!0}),s.value=st.small):e<=1e3?(null==a||a.dispatch("SET_GLOBAL_SETTINGS",{elementPlusSize:st.default,folded:!1}),s.value=st.default):(null==a||a.dispatch("SET_GLOBAL_SETTINGS",{elementPlusSize:st.large,folded:!1}),s.value=st.large)},r=e=>{t.proxy.$i18n.locale="zh-CN",l.value=Le,Xe(tl.currentRoute.value.meta.title)},d=()=>{o(window.innerWidth),window.addEventListener("resize",((e,t=500)=>{let a,i;return function(...s){i=s,a||(a=setTimeout((()=>{e(...i),a=void 0}),t))}})((e=>{o(e.target.innerWidth)}),600)),al(),r(i.language),(async()=>{var e;const{authorized:t,installed:a,token:i,isAutoAuthorize:s}=f((()=>ia.getters.getGitHubAuthorizationInfo)).value,l=async e=>{tl.push({path:"/login",query:{jump:"0"}}).then((()=>{e&&e()}))};if(s&&t&&a&&i&&Bi()){const t=u.error({customClass:"custom-message-container",duration:0,showClose:!0,message:`<div class="content-box authorization">\n                    <span class="msg">${Ne.global.t("authorization.msg_1")}</span>\n                    <spna class="btn-box">\n                      <span class="confirm btn">${Ne.global.t("authorization.text_13")}</span>\n                    </spna>\n                  </div>`,dangerouslyUseHTMLString:!0,onClose:()=>{l()}});null==(e=document.querySelector(".custom-message-container .authorization .confirm"))||e.addEventListener("click",(()=>{t.close(),l((()=>{ia.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{authorizing:!0})}))})),await l()}})()};return U((()=>i.language),(e=>{r()})),y((()=>{d()})),(e,t)=>(n(),H(F(ke),{size:s.value,"z-index":3e3,locale:l.value},{default:x((()=>[O(zl)])),_:1},8,["size","locale"]))}}),Fl=I({__name:"App",setup:e=>(e,t)=>(n(),H(Hl))});const Vl=f((()=>ia.getters.getUserConfigInfo)).value,{owner:Bl,repo:Xl}=Vl,ql=e=>{v.confirm(`\n    <div>${Ne.global.t("management_page.delTips")}：</div>\n    <strong>${e.name}</strong>\n    `,Ne.global.t("tip"),{dangerouslyUseHTMLString:!0,type:"warning"}).then((async()=>{await(async e=>{e.deleting=!0;const{path:t,sha:a}=e;await yt(Bl,Xl,t,a)?(u.success({message:Ne.global.t("management_page.message5")}),await ia.dispatch("DIR_IMAGE_LIST_REMOVE",e),await ia.dispatch("UPLOAD_IMG_LIST_REMOVE",e.uuid)):u.error({message:Ne.global.t("management_page.message7")})})(e)})).catch((()=>{}))},Jl=async(e,t)=>{const a=$t(e.name),i=ze(),s=`${t}.${a}`;let l;var n;if(l=a.includes("svg")?await(n=Gt(e)||"",new Promise((e=>{vt({baseURL:"",url:n,method:"GET",responseType:"blob"}).then((t=>{if(t){const a=new FileReader;a.onload=()=>{const t=a.result;e(t)},a.onerror=()=>{e(null)},a.readAsDataURL(t)}else e(null)})).catch((()=>{e(null)}))}))):await Ct(Gt(e)||"",a),l){const t={uuid:"",base64:{originalBase64:"",watermarkBase64:null,compressBase64:null},fileInfo:{originalFile:null,watermarkFile:null,compressFile:null},filename:{hash:"",suffix:"",name:"",prefix:"",final:"",initName:"",newName:"",isAddHash:!0,isRename:!1,isAddPrefix:!1},beforeUploadStatus:{watermarking:!1,compressing:!1},uploadStatus:{progress:0,uploading:!1},reUploadInfo:{dir:"",path:"",isReUpload:!1}};t.uuid=i,t.base64.originalBase64=l,t.filename.final=s,t.reUploadInfo.isReUpload=!0,t.reUploadInfo.dir=e.dir;let a=s;"/"!==e.dir&&(a=`${e.dir}/${s}`),t.reUploadInfo.path=a;if(await pa(Vl,t)){const{path:t,sha:a}=e;return await yt(Bl,Xl,t,a),await ia.dispatch("UPLOAD_IMG_LIST_REMOVE",e.uuid),await ia.dispatch("DIR_IMAGE_LIST_REMOVE",e),Promise.resolve(!0)}return Promise.resolve(!1)}return Promise.resolve(!1)},Kl="custom-contextmenu-container";let Wl=null,Zl=!1;const Yl={mounted(e,t){e.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation();const{type:a,dir:i,img:s}=t.value;ia.commit("SET_UPLOAD_AREA_STATE",{activeInfo:{dir:i,type:a,img:s}});const l=f((()=>ia.getters.getUserViewDir)).value,n=i?`${"/"===l?"":`${l}/`}${i}`:l;Wl=document.querySelector(`.${Kl}`),Wl||(Wl=document.createElement("ul"),Wl.setAttribute("class",Kl),Wl.style.position="fixed",Wl.style.zIndex="1000",Wl.innerHTML=`<li class="custom-contextmenu-item upload-image">\n                             </li>\n                             <li class="custom-contextmenu-item paste-image">\n                               ${Ne.global.t("paste_image")}\n                             </li>\n                             <li class="custom-contextmenu-item copy-link">\n                               ${Ne.global.t("copy_link")}\n                             </li>\n                             <li class="custom-contextmenu-item property">\n                               ${Ne.global.t("management_page.property")}\n                             </li>\n                             <li class="custom-contextmenu-item rename">\n                               ${Ne.global.t("rename")}\n                             </li>\n                             <li class="custom-contextmenu-item remove">\n                               ${Ne.global.t("delete")}\n                             </li>\n                             `,document.body.appendChild(Wl));const o=null==Wl?void 0:Wl.querySelector(".upload-image"),r=null==Wl?void 0:Wl.querySelector(".remove"),d=null==Wl?void 0:Wl.querySelector(".rename"),c=null==Wl?void 0:Wl.querySelector(".copy-link"),g=null==Wl?void 0:Wl.querySelector(".property"),m=null==Wl?void 0:Wl.querySelector(".paste-image"),p=()=>{Wl.querySelectorAll(".custom-contextmenu-item").forEach((e=>{e.style.display="none"}))},_=e=>{e.forEach((e=>{e.style.display="flex"}))};a===cs.img&&(p(),_([c,r,d,g])),a===cs.dir&&(p(),_([o]),o.innerHTML=Ne.global.t("management_page.contextmenu_2",{dir:n})),a===cs.dirArea&&(p(),_([o]),o.innerHTML=Ne.global.t("management_page.contextmenu_1")),a===cs.uploadArea&&(p(),_([m]));let h=e.clientX,b=e.clientY;const w=Wl.clientWidth,I=Wl.clientHeight,S=document.documentElement.clientWidth,y=document.documentElement.clientHeight;w+h>S&&(h=S-w-6),I+b>y&&(b=y-I-6),Wl.style.top=`${b}px`,Wl.style.left=`${h}px`,Zl||(Zl=!0,null==o||o.addEventListener("click",(async()=>{const e="/"===n?at.rootDir:at.repoDir,t="/"===n?[]:n.split("/");await ia.dispatch("SET_USER_CONFIG_INFO",{dirMode:e,selectedDir:n,selectedDirList:t}),await tl.push("/upload")})),null==d||d.addEventListener("click",(async()=>{a===cs.img&&await(async e=>{const t=(e=>{const t=e.lastIndexOf(".");return e.substring(0,t).trim().replace(/\s+/g,"-")})(e.name);await v.prompt(Ne.global.t("management_page.text_1"),Ne.global.t("tip"),{draggable:!0,inputPattern:/^.+$/,inputErrorMessage:Ne.global.t("management_page.message1"),autofocus:!0,inputValue:t,beforeClose:async(a,i,s)=>{if("confirm"===a){if(i.inputValue===t)return void u.warning(Ne.global.t("management_page.message2"));i.confirmButtonLoading=!0,i.confirmButtonText=Ne.global.t("management_page.loadingTxt2"),await Jl(e,i.inputValue)?(i.confirmButtonLoading=!1,u.success(Ne.global.t("management_page.message4")),s()):u.error(Ne.global.t("management_page.message3"))}else s()}})})(s),cs.dir})),null==r||r.addEventListener("click",(async()=>{a===cs.img&&ql(s),cs.dir})),null==c||c.addEventListener("click",(async()=>{jt(s)})),null==g||g.addEventListener("click",(async()=>{await(async e=>{await v.confirm(`\n    <div>${Ne.global.t("management_page.imageName")}：<strong>${e.name}</strong></div>\n    <div>${Ne.global.t("management_page.imageSize")}：<strong>${Ut(e.size)} KB</strong></div>\n    `,Ne.global.t("management_page.property"),{showCancelButton:!1,showConfirmButton:!1,dangerouslyUseHTMLString:!0,type:"info"})})(s)})),null==m||m.addEventListener("click",(()=>{ia.commit("SET_UPLOAD_AREA_STATE",{isPaste:!0})})));const E=()=>{ia.commit("SET_UPLOAD_AREA_STATE",{activeInfo:null}),Wl&&(document.removeEventListener("click",E),document.body.removeChild(Wl),Wl=null,Zl=!1)};document.addEventListener("click",E),document.addEventListener("dblclick",E)}))}},Ql=Ae(Fl);Ql.directive("contextmenu",Yl),Ql.use(tl).use(ia,sa).use(Ne).mount("#app");
